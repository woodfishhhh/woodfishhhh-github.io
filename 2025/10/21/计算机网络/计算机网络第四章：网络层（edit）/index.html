<!DOCTYPE html><html lang="zh-Hans" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>木鱼的鱼窝 | 木鱼的鱼窝</title><meta name="keywords" content="woodfish的keyword"><meta name="author" content="woodfish"><meta name="copyright" content="woodfish"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="木鱼的鱼窝"><meta name="application-name" content="木鱼的鱼窝"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="木鱼的鱼窝"><meta property="og:url" content="https://www.woodfishhhh.xyz/2025/10/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%88edit%EF%BC%89/index.html"><meta property="og:site_name" content="木鱼的鱼窝"><meta property="og:description" content="4.1 网络层概述网络层是 OSI 体系结构自下而上的第三层，核心任务是将分组从源主机经多个网络和链路传输到目的主机，主要包含分组转发、路由选择两大功能，且能向上层提供两种服务。 4.1.1 分组转发和路由选择 分组转发：路由器从某接口接收分组后，依据分组首部的转发标识（可能是目的地址或连接指示）查"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://pic1.imgdb.cn/item/682f3d1658cb8da5c807b704.jpg"><meta property="article:author" content="woodfish"><meta property="article:tag" content="woodfish的keyword"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://pic1.imgdb.cn/item/682f3d1658cb8da5c807b704.jpg"><meta name="description" content="4.1 网络层概述网络层是 OSI 体系结构自下而上的第三层，核心任务是将分组从源主机经多个网络和链路传输到目的主机，主要包含分组转发、路由选择两大功能，且能向上层提供两种服务。 4.1.1 分组转发和路由选择 分组转发：路由器从某接口接收分组后，依据分组首部的转发标识（可能是目的地址或连接指示）查"><link rel="shortcut icon" href="https://pic1.imgdb.cn/item/682f3d1658cb8da5c807b704.jpg"><link rel="canonical" href="https://www.woodfishhhh.xyz/2025/10/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%88edit%EF%BC%89/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script defer="defer" src="https://va.vercel-scripts.com/v1/script.js" data-website-id="prj_woodfishhhh-github-io"></script><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"交换友链！芜湖！","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: undefined,
  diytitle: {"enable":true,"leaveTitle":"不要忘记我----------------------------------------","backTitle":"我喜欢你-------------------------------------------"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: false,
  mainTone: undefined,
  authorStatus: {"skills":[null,null,null,null,null,null,null,null,null,null,null]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":true,"limitCount":50,"languages":{"author":"作者: woodfish","link":"链接: ","source":"来源: 木鱼的鱼窝","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '木鱼的鱼窝',
  title: '木鱼的鱼窝',
  postAI: '',
  pageFillDescription: '4.1 网络层概述, 4.1.1 分组转发和路由选择, 4.1.2 网络层向其上层提供的两种服务, 4.2 网际协议（IP）, 4.2.1 异构网络互连, 4.2.2 IPv4 地址及其编址方法, 4.2.3 IPv4 地址的应用规划, 4.2.4 IPv4 地址与 MAC 地址, 4.2.5 地址解析协议, 4.2.6 IP 数据报的发送和转发过程, 4.2.7 IPv4 数据报的首部格式, 4.3 静态路由配置, 4.3.1 直连路由和非直连路由, 4.3.2 默认路由和特定主机路由, 4.4 因特网的路由选择协议, 4.4.1 路由选择分类, 4.4.2 因特网采用分层次的路由选择协议, 4.4.3 路由信息协议（RIP）, 4.4.4 开放最短路径优先协议（OSPF）, 4.4.5 边界网关协议（BGP）, 4.4.6 路由器的基本工作原理, 4.5 网际控制报文协议（ICMP）, 4.5.1 ICMP 报文的种类, 4.5.2 ICMP 的典型应用, 4.6 虚拟专用网（VPN）和网络地址转换（NAT）, 4.6.1 虚拟专用网（VPN）, 4.6.2 网络地址转换（NAT）, 4.7 IP 多播, 4.7.1 IP 多播技术的相关基本概念, 4.7.2 IP 多播地址和多播组, 4.7.3 在局域网上进行硬件多播, 4.7.4 在因特网上进行 IP 多播需要的两种协议, 4.7.5 网际组管理协议（IGMP）, 4.7.6 多播路由选择协议, 4.8 移动 IP 技术, 4.8.1 移动性对因特网应用的影响, 4.8.2 移动 IP 技术的相关基本概念, 4.8.3 移动 IP 技术的基本工作原理, 4.8.4 蜂窝移动通信网中的移动性管理, 4.9 下一代网际协议 IPv6, 4.9.1 IPv6 引进的主要变化, 4.9.2 IPv6 数据报的基本首部, 4.9.3 IPv6 数据报的扩展首部, 4.9.4 IPv6 地址, 4.9.5 从 IPv4 向 IPv6 过渡, 4.9.6 网际控制报文协议 ICMPv6, 4.10 软件定义网络（SDN）网络层概述网络层是体系结构自下而上的第三层核心任务是将分组从源主机经多个网络和链路传输到目的主机主要包含分组转发路由选择两大功能且能向上层提供两种服务分组转发和路由选择分组转发路由器从某接口接收分组后依据分组首部的转发标识可能是目的地址或连接指示查询自身的转发表再将分组从合适接口转发给下一跳路由器或目的主机每个路由器都需维护转发表例如路由器从接口收到分组根据首部转发标识查询转发表得知应从接口转发路由选择源主机与目的主机间可能存在多条路径网络层需确定选择哪条路径传分组以主机与为例存在和两条路径选择依赖路由选择方式主要有三种集中式路由选择由网络控制中心执行路由选择向各路由器下载路由信息分布式路由选择各路由器运行路由选择协议相互交换路由信息并自行计算路由人工路由选择由网络运维人员手动配置路由路由表与转发表路由选择生成路由表仅含目的网络到下一跳的映射需优化网络拓扑变化计算转发表由路由表得出结构需优化查找过程本书讨论路由选择原理时不严格区分二者以路由表表述功能描述分组转发路由器依据分组首部信息查询转发表将分组从合适接口转发路由选择确定分组从源到目的的最佳路径网络服务向上层提供无连接或面向连接的服务网络层向其上层提供的两种服务面向连接的虚电路服务核心思想可靠通信由网络自身保证通信过程首先建立虚电路逻辑连接非物理连接确保通信所需网络资源然后双方沿虚电路发送分组分组首部在连接建立阶段用完整目的主机地址之后仅需携带虚电路编号通信结束后释放虚电路特点分组按逻辑连接存储转发若用可靠传输协议可使分组无差错按序到达不丢失不重复无连接的数据报服务核心思想可靠通信由用户主机保证通信过程通信前无需建立网络层连接每个分组可走不同路径首部需携带完整目的主机地址分组可能误码丢失重复和失序通信结束后无需释放连接特点网络中路由器结构简单成本低因特网采用此服务将复杂处理功能置于边缘用户主机及内部运输层核心仅提供尽最大努力的分组交付功能使网络造价低运行灵活适应多种应用两种服务对比二者在思路连接需求目的地址使用分组转发方式节点故障影响分组顺序服务质量实现难度等方面存在明显差异具体可参考表在体系结构中网际层向上层提供无连接尽最大努力交付的数据报服务网际协议网际协议是体系结构网络层的核心协议本节介绍的是与配套使用的有四个协议其中已淘汰异构网络互连异构网络特点因特网由众多拓扑性能协议不同的网络通过路由器互连因用户需求多样无单一网络能适应所有需求互连问题异构网络互连需解决不同的网络接入机制差错恢复方法路由选择技术寻址方案最大分组长度服务类型等问题网概念各异构网络的网络层使用相同的协议从网络层看如同统一的网网上主机通信时无需关注各网络异构细节如同在单个网络通信地址及其编址方法表示方法采用点分十进制表示法将比特地址每比特为一组转换为十进制数组间用分隔示例类别首比特网络号长度主机号长度地址范围默认子网掩码类比特比特类比特比特类比特比特类类划分子网目的解决分类编址地址浪费问题地址结构变化分类编址网络号主机号两级结构划分子网网络号子网号主机号三级结构子网掩码比特连续对应网络号和子网号连续对应主机号无分类编址特点消除分类编址和划分子网概念地址结构网络前缀主机号两级结构网络前缀不定长使用斜线记法地址网络前缀比特数地址的应用规划地址应用规划是将给定地址块或分类网络划分为更小地址块或子网分配给不同网络再给主机和路由器接口分配地址主要有两种方法定长的子网掩码划分的每个子网用同一子网掩码地址数量相同易造成地址浪费例如类网络按需求借用比特作为子网号划分为个子网每个子网个地址分配给不同网络时部分网络可能用不完地址变长的子网掩码每个子网可使用不同子网掩码地址数量按需分配减少地址浪费例如地址块根据各网络地址需求分别划分出等不同前缀长度的地址块分配满足不同网络需求避免浪费地址与地址封装位置地址是网际层及以上各层使用的地址封装在数据报首部地址硬件物理地址是数据链路层使用的地址封装在帧首部传送过程中变化分组传输时源地址和目的地址始终不变源地址和目的地址逐网络或逐链路变化例如主机给发送分组经转发到帧的源是的目的是的到帧的源是转发接口的目的是的到帧的源是转发接口的目的是的而数据报的源和目的始终是和的二者关系仅用地址通信会导致路由器路由表需记录海量地址配置和维护困难且占用大量通信资源和存储空间增加分组转发时延网际层用地址寻址减少路由表条目但需地址解析协议获取下一跳的地址以完成数据链路层帧的封装地址解析协议协议功能是通过已知地址找到对应的地址主机维护高速缓存表记录与地址对应关系分动态和静态动态由自动获取生命周期默认分钟静态由人工配置当主机要给其他主机发送分组先查高速缓存表未找到则发送请求报文广播含自身及目标目标主机收到后记录发送方与到自身缓存表再发送响应报文单播含自身发送方收到后更新自身缓存表即可进行分组发送协议仅在同一局域网使用跨网络通信时需在各段链路分别使用协议功能是使仅知自身地址的主机找出地址现因协议包含其功能已不再使用协议归属有的教材将其划归网际层有的划归数据链路层均合理除请求和响应报文还有无故等类型报文且协议无安全验证机制存在欺骗和攻击问题数据报的发送和转发过程主机发送数据报直接交付同一网络中主机通信源主机通过获取目的主机地址将数据报封装成帧发送判断是否同一网络需将自身和目的主机地址的网络前缀保持不变主机号清零若得到的网络地址相同则为同一网络间接交付不同网络中主机通信源主机通过获取默认网关路由器地址将数据报封装成帧发送给默认网关由网关转发路由器转发数据报路由器收到正确数据报未结束首部无误码后根据目的地址查询路由表查到匹配条目则按指示转发查不到则丢弃并向源主机发送差错报告例如主机给发送数据报路由器收到后将目的与路由表中地址掩码逐比特逻辑与运算找到匹配的目的网络条目从对应接口转发给路由器不转发目的地址为广播地址的数据报以隔离广播域避免广播风暴数据报的首部格式数据报首部由字节固定部分和最大字节可变部分组成各字段含义如下版本比特表协议版本目前为首部长度可选字段和填充首部长度比特以字节为单位最小字节固定部分最大字节固定字节可变可选字段字节支持排错测量等功能较少使用填充字段用全填充确保首部长度为字节整数倍区分服务比特旧称服务类型现用于提供不同服务质量一般不使用总长度比特以字节为单位表数据报总长度首部数据载荷最大字节标识标志和片偏移共同用于数据报分片标识比特同一数据报的分片标识相同标志比特最低位表后面有分片表无中间位表不允许分片表允许最高位保留为片偏移比特以字节为单位表分片数据载荷偏移原数据报的位置生存时间比特最初以秒为单位现以跳数为单位源主机设置初始值路由器转发时减为则丢弃防止数据报无限兜圈协议比特指明数据载荷的协议类型如对应对应等首部检验和比特检测首部传输差错路由器转发时需重新计算计算方法为发送方将首部划分为比特字序列检验和字段置反码算术求和后取反码写入接收方重新求和取反码结果为则无差错否则丢弃源地址和目的地址各比特分别表发送方和接收方地址静态路由配置静态路由配置是人工给路由器配置路由表简单开销小但不能适应网络状态变化适用于小规模网络直连路由和非直连路由直连路由路由器给各接口配置地址和地址掩码后自行得出各接口直连网络的路由条目记录在路由表中非直连路由路由器到其他非直连网络的路由由人工配置静态路由或通过路由选择协议自动获取动态路由例如路由器的接口直连网络对应路由条目为直连路由到直连的另一网络的路由条目由人工配置为非直连路由默认路由和特定主机路由默认路由若路由器查不到匹配路由条目按默认路由转发默认路由条目目的网络为匹配优先级最低最长前缀匹配原则可减少路由表存储和查找时间例如路由器到因特网的路由配置默认路由下一跳为无需配置到因特网各网络的路由条目特定主机路由针对某一台主机的路由目的网络为该主机匹配优先级最高用于安全控制网络测试和排错例如路由器到主机的路由配置特定主机路由下一跳为配置静态路由需谨慎避免路由环路因特网的路由选择协议路由选择分类静态路由选择人工配置路由条目简单开销小但不适应网络状态变化适用于小规模网络动态路由选择路由器通过路由选择协议自动获取路由信息复杂开销大但能适应网络状态变化适用于大规模网络因特网采用分层次的路由选择协议特点自适应动态路由适应网络状态变化分布式各路由器交换信息共同完成路由获取和更新分层次将因特网划分为自治系统内和间用不同路由选择协议路由选择协议分类内部网关协议用于内路由选择各可选择不同如外部网关协议用于间路由选择域间路由选择如早期用网关现新文档用路由器二者称呼均可路由信息协议基本概念是早期广泛使用的标准文档基于距离向量算法用跳数衡量到目的网络的距离直连网络距离非直连为经过路由器数最大跳数表不可达适用于小型互联网认为跳数少的路由是好路由可进行等价负载均衡仅与相邻路由器周期性约秒交换自身路由表信息网络拓扑变化时触发更新加快收敛工作过程路由器初始仅知直连网络路由与相邻路由器周期性交换更新路由信息多次交换更新后各路由器知晓内各网络最短距离和下一跳实现收敛距离向量算法路由器收到相邻路由器路由更新报文后修改报文下一跳改为该路由器距离加再更新自身路由表更新规则包括相同下一跳无论距离变化均更新发现新网络添加路由条目不同下一跳新路由距离更小则更新不同下一跳新路由距离相同则添加条目等价负载均衡不同下一跳新路由距离更大则不更新还包含时间参数如秒发送更新报文秒未收更新则标记路由无效再秒未收则删除该路由存在问题坏消息传播得慢易形成路由环路可持续数分钟可通过限制最大跳数触发更新水平分割等措施减少问题概率或危害但无法彻底解决因路由器缺少目的网络完整路径信息无法判断路由是否环路版本和报文最新版本支持鉴别和多播报文用端口传送属应用层但核心功能属网际层优缺点优点是实现简单路由器开销小好消息传播快缺点是限制最大跳数网络规模受限相邻路由器交换完整路由表网络规模扩大时开销增加坏消息传播慢收敛时间长大规模应使用小规模仍常用开放最短路径优先协议基本概念年开发克服缺点开放指协议公开发表最短路径优先因使用算法基于链路状态路由器相邻关系及链路代价代价由网络管理人员决定如思科路由器用除以链路带宽计算无路由环路不限制网络规模更新效率高收敛快关键机制邻居关系建立和维护相邻路由器通过分组封装在数据报发往组播地址协议号建立和维护邻居关系分组发送周期秒秒未收则认为邻居不可达主机建立邻居表链路状态通告每个路由器产生含直连网络和邻居路由器的链路状态信息链路状态更新分组封装在中用洪泛法发送使各路由器链路状态数据库一致链路状态数据库存储各路由器一致后基于算法计算最短路径构建路由表分组类型共五种分别是问候分组发现和维护邻居可达性数据库描述分组给邻居发送摘要链路状态请求分组请求邻居发送特定详细信息链路状态更新分组洪泛发送链路状态确认分组确认工作过程相邻路由器交换分组建立邻居关系发送数据库描述分组共享摘要根据缺少的发送链路状态请求分组邻居发送请求方更新并发送确认同步后路由器基于计算路由表每分钟或链路状态变化时洪泛发送更新多点接入网络优化选举指定路由器和备用指定路由器普通路由器仅与建立邻居关系减少分组发送数量故障时顶替区域划分将划分为多个区域主干区域标识连通其他区域各区域有区域边界路由器连接自身区域和主干区域区域内路由器所有接口在同一区域主干路由器主干区域内路由器含区域边界路由器自治系统边界路由器主干区域内与其他交换路由信息的路由器区域划分将洪泛范围局限于区域减少通信量边界网关协议基本概念属用于间路由选择因不同度量路由代价不同且需考虑政治经济安全等策略不寻找最佳路由仅寻找能到达目的网络且无环路的较好路由边界路由器每个选择至少一个路由器作为发言人常为边界路由器不同的发言人通过建立连接端口进行会话交换路由信息网络可达性即到达网络需经过的序列构建无环路的连通图发言人还需运行所在的如报文共四种报文建立关系初始化通信报文通告路由信息撤销过时路由报文周期性证实邻站连通性约秒发送仅字节报文发送差错信息增加报文请求对等方重新通告路由初始交换完整路由表后续仅更新变化部分路由器的基本工作原理路由器是有多个输入输出端口的专用计算机任务是转发分组分为路由选择和分组转发两部分路由选择部分核心是路由选择处理机根据路由选择协议周期性与其他路由器交换路由信息构建和更新路由表分组转发部分由输入端口交换结构输出端口组成信号从输入端口进入物理层转比特流给数据链路层数据链路层识别帧去帧头帧尾给网络层若为普通待转发数据分组网络层根据目的地址查转发表更新分组首部如减交数据链路层封装成帧物理层发送若为路由分组交路由选择处理机更新路由表路由选择处理机还会周期性发送路由信息缓冲区各端口有输入缓冲区暂存待处理分组和输出缓冲区暂存待发送分组交换结构是关键构件实现分组从输入端口到输出端口的转发有通过存储器总线互连网络三种实现方式转发速率依次提高网际控制报文协议为有效转发数据报提高交付成功率体系结构网际层使用主机或路由器用其发送差错报告和询问报文报文封装在数据报中发送报文的种类差错报告报文用于报告差错情况共五种终点不可达路由器或主机不能交付数据报时发送细分为目的网络主机协议端口不可达等种错误例如路由器路由表无所在网络路由收到给的数据报后丢弃并发送终点不可达报文给源点抑制路由器或主机因拥塞丢弃数据报时发送使源主机降低发送速率例如路由器拥塞丢弃给的数据报发送源点抑制报文给时间超过超时路由器转发数据报时减为则丢弃并发送终点未在规定时间收到全部数据报片丢弃已收片并发送例如发送的数据报经丢弃并发送时间超过报文给参数问题路由器或目的主机收到数据报首部检验和出错则丢弃并发送例如给的数据报首部受干扰出错检测到后丢弃并发送参数问题报文给改变路由重定向路由器告知主机下次应将数据报发送给其他路由器以选择更好路由例如默认网关为发现发往的最佳路由经发送改变路由报文给更新路由表不发送差错报告报文的情况对差错报告报文不发送对第一个分片后续的分片不发送对多播地址的数据报不发送对特殊地址如的数据报不发送询问报文常用的有回送请求和回答测试目的站可达性及状态时间戳请求和回答请求日期时间用于时钟同步和时间测量的典型应用分组网间探测测试主机或路由器连通性应用层直接使用不使用或用回送请求和回答报文例如发送个回送请求报文给服务器收到个回送回答报文可得出连通性和往返时间部分主机服务器可能不理睬该报文以防攻击跟踪路由工具中为用差错报告报文中为直接用回送请求回答及差错报告报文原理主机发送回送请求报文依次设为时第一台路由器收到后减为丢弃并发送时间超过报文主机知第一台路由器时第二台路由器收到后减为丢弃并发送时间超过报文主机知第二台路由器直至足够大目的主机收到后发送回送回答报文主机知到达目的主机例如跟踪到的路由依次发送的报文获取各路由器地址虚拟专用网和网络地址转换虚拟专用网概念引入远程专用网通信有两种方式租用电信线路简单但费用高或利用因特网作为载体即成本低专用网内主机用专用地址规定仅在机构内部有效因特网路由器不转发目的地址为专用地址的数据报工作原理专用网需至少一个路由器有全球地址进行配置源主机发送内部数据报给路由器路由器加密内部数据报重新封装成外部数据报源目的为路由器全球通过因特网发送给目的专用网路由器目的路由器解密提取内部数据报发送给目的主机逻辑上像专用网通信使用隧道技术类型内联网同一机构内不同部门专用网构成外联网机构包含外部合作伙伴远程接入外地员工通过因特网访问公司专用网网络地址转换背景为缓解地址耗尽问题年提出使大量用内部专用地址的主机共享少量外部全球地址访问因特网需在专用网连接因特网的路由器路由器上安装软件路由器至少有一个全球基本方法源主机给外部主机发送数据报路由器从全球地址池选临时全球地址修改数据报源地址记录内部与全球对应关系转发数据报外部主机发回数据报路由器根据对应关系修改目的地址为内部转发给源主机缺点是路由器有个全球专用网最多台主机同时接入因特网网络地址与端口号转换结合运输层端口号使大量内部主机共用个全球路由器收到内部主机数据报修改源地址为全球修改运输层源端口号记录内部端口与全球端口对应关系转发数据报收到外部主机数据报根据对应关系修改目的地址和端口号转发给内部主机对部分网络应用不透明通信需由专用网内部发起内部主机不能直接充当因特网服务器应用需穿透技术多播多播技术的相关基本概念多播组播是一对多通信技术相比单播一对一可节省网络资源多播由于年提出年月首次实验例如视频服务器向个主机传视频单播需发个多播仅发个路由器按需复制局域网利用硬件多播多播组成员均可接收因特网实现多播需路由器支持多播功能涉及多播寻址和路由选择协议多播地址和多播组多播地址中类地址为多播地址首位剩余位可变范围仅作目的地址多播组每个类地址标识一个多播组使用同一多播地址接收数据报的主机构成多播组成员可动态变动主机可属多个多播组非成员也可向多播组发送数据报多播数据报尽最大努力交付类地址分类分预留多播地址永久全球可用多播地址本地管理多播地址仅本地有效多播类型本局域网上的硬件多播因特网上的多播因特网上多播最后阶段需在局域网用硬件多播交付在局域网上进行硬件多播局域网支持硬件多播将多播地址映射为多播地址分配的地址多播地址首比特固定剩余比特来自类地址低比特导致多播与地址映射不唯一收到多播数据报的主机先通过地址判断是否属本硬件多播组是则交网际层网际层再根据地址判断是否属本多播组是则接受否则丢弃在因特网上进行多播需要的两种协议因特网上多播需网际组管理协议和多播路由选择协议使本地局域网多播路由器知本局域网上是否有主机加入退出多播组仅在本网络有效不知多播组成员数量和分布多播路由选择协议使多播路由器协同工作为每个多播组建立多播转发树多播数据报沿树洪泛再通过硬件多播发送给成员网际组管理协议基本概念最新版本有成员报告成员查询离开组三种报文封装在多播数据报中发送协议字段目的地址为多播地址工作原理加入多播组主机发送成员报告报文含要加入的多播组地址数据报目的地址为该多播组地址同组其他成员监听到则取消发送多播路由器收到未知多播组的报告将该多播组地址添加到多播组列表不记录主机监视多播组成员变化多播路由器默认每秒发送成员查询报文含特定多播组地址或全数据报目的地址收到的多播组成员延迟秒随机响应若收到同组其他成员响应则取消长时间未收某多播组响应将其从列表删除同一网络多播路由器选举查询路由器地址最小发送查询报文退出多播组支持主机主动发送离开组报文含要退出的多播组地址数据报目的地址多播路由器收到后立即针对该多播组发送查询报文预定时间未收响应则删除该多播组多播路由选择协议多播路由选择协议为每个多播组建立多播转发树有两种构建方法基于源树的多播路由选择典型算法反向路径多播先通过反向路径广播建立广播转发树避免洪泛法在环路网络的问题检查广播分组是否从源点最短路径传来是则转发再用剪枝算法剪除下游非成员路由器获得多播转发树被剪枝路由器若又发现多播组成员可发送嫁接报文重新加入组共享树多播路由选择用基于核心的分布式生成树算法指定核心路由器以其为根建立多播转发树成员路由器向核心路由器单播加入报文加入报文路径构成树的分支嫁接到现有树上因特网多播路由选择协议目前无全球使用的协议建议使用的有等多播目前主要用于局部网络应用层多播技术也在发展多播路由选择协议算法思想仍适用移动技术移动性对因特网应用的影响无影响场景主机在同一服务区移动不变主机在不同地点关机后重新上网通过获取新对用户透明有影响场景主机在不同网络间移动且需不间断通信如汽车中下载视频因切换网络导致变化应用程序无法向变动的主机发送数据地址指明主机及所在网络移动主机切换网络必变否则数据报仍路由到原网络移动技术的相关基本概念移动使移动主机在网络间漫游时保持原不变且非移动主机可正确向其发送数据报无需改变非移动主机软件和多数路由器工作方式归属网络归属地址永久地址归属代理归属网络是移动主机默认连接或初始接入的网络归属地址是移动主机在归属网络的通信中不变归属代理是归属网络中执行移动管理功能的实体通常是路由器功能在应用层完成外地网络被访网络外地代理转交地址外地网络是移动主机当前漫游的网络外地代理是外地网络中帮助移动主机执行移动管理功能的实体通常是路由器转交地址是外地代理为移动主机提供的临时外地网络地址工作过程移动主机漫游到外地网络归属代理代收其数据报用转交地址通过隧道转发给外地代理外地代理再转发给移动主机对固定主机透明移动技术的基本工作原理代理发现与注册移动主机漫游到外地网络通过代理发现协议与外地代理建立联系获取转交地址并注册外地代理向归属代理注册移动主机转交地址归属代理记录转交地址代收并转发数据报固定主机向移动主机发送数据报固定主机发送数据报目的为移动主机归属地址路由到归属网络归属代理代收封装成新数据报目的为转交地址通过隧道发送给外地代理外地代理解封转发给移动主机归属代理用代理技术代收数据报转交地址可为外地代理地址多主机共享外地代理通过记录移动主机永久地址与地址对应关系转发数据报移动主机向固定主机发送数据报移动主机发送数据报源为归属地址目的为固定主机按正常流程发送将外地代理或外地网络路由器设为默认网关无需经归属代理转发同址转交地址外地代理可运行在移动主机上此时转交地址为同址转交地址既是外地代理也是移动主机地址移动主机需通过获取外地网络地址运行外地代理软件三角形路由问题固定主机向移动主机发送数据报需经归属代理转发可能存在低效路径如固定主机与移动主机在同一外地网络解决方法是固定主机配置通信代理从归属代理获取移动主机转交地址直接通过隧道发送但增加复杂性且对固定主机不透明蜂窝移动通信网中的移动性管理蜂窝移动通信网更早支持移动性用户手机漫游用同一电话号码通话不中断采用类似移动但更复杂的机制分组域核心网络支持用移动为数据业务提供移动性服务其他标准在层以下提供且仅在网络内部提供移动性服务目前移动未在全球因特网大规模使用下一代网际协议引进的主要变化地址设计缺陷导致地址耗尽年宣布地址分配完毕我国年停止分配并部署支持无连接尽最大努力交付称协议数据单元为分组本书仍称数据报主要变化更大地址空间地址长度从比特增至比特地址空间极大可预见未来不会用完扩展的地址层次结构地址空间大可划分更多层次反映因特网拓扑优化寻址和路由设计灵活的首部格式首部与不兼容定义可选扩展首部提高路由器处理效率仅处理逐跳扩展首部改进的选项允许数据报含选项控制信息可添加新选项选项固定允许协议继续扩充适应技术发展和新应用出现功能固定支持即插即用自动配置主机或路由器自动配置地址及网络参数无需支持资源预分配为实时音视频等应用提供更好服务质量保证数据报的基本首部数据报由字节基本首部和可变长度有效载荷含零个或多个扩展首部及数据部分组成与首部相比取消了首部长度服务类型总长度标识标志片偏移协议检验和选项等字段新增通信量类流标号字段修改为跳数限制协议改为下一个首部基本首部各字段含义版本比特对应值为通信量类比特区分数据报类别或优先级流标号比特标识流特定源到目的的一系列数据报用于资源预分配非实时数据置有效载荷长度比特表基本首部后有效载荷字节数最大字节下一个首部比特无扩展首部时表数据协议类型有扩展首部时表首个扩展首部类型跳数限制比特源主机设初始值最大路由器转发时减为则丢弃源地址目的地址各比特分别表发送端和接收端地址数据报的扩展首部将首部选项放入扩展首部由源点和终点主机处理路径中路由器不处理除逐跳选项扩展首部提高处理效率定义六种扩展首部逐跳选项路由选择分片鉴别封装安全有效载荷目的站选项每个扩展首部首字段为比特下一个首部字段多个扩展首部按特定顺序出现地址地址分配给节点每个接口指派地址节点可有多个单播地址地址空间大小比特地址空间为极其巨大可满足未来需求表示方法采用冒号十六进制记法将比特每比特为一组共组组间用分隔每组比特转十六进制数可左侧零省略十六进制数前导零省略和连续零压缩连续零用替代一个地址仅用一次还可结合点分十进制后缀过渡阶段用斜线记法仍适用地址分类目的地址类型单播点对点多播一点对多点广播为多播特例任播一点对一组中最近一个地址分类未指明地址全缩写仅作源地址环回地址仅最低比特其余全缩写多播地址首比特全记为本地链路单播地址首比特记为仅本地网络通信全球单播地址除上述四种三级结构比特全球路由选择前缀比特子网标识符比特接口标识符从向过渡因因特网上路由器数量多过渡需逐步进行新系统需兼容主要有两种过渡策略双协议栈主机或路由器装和两套协议栈可与两种系统通信记为双协议栈主机通过查询目的主机地址类型选择对应协议通信例如主机给发送数据报经路由器及路由器将数据报转为数据报转发再恢复为数据报给转换可能损失部分字段信息隧道技术数据报进入网络时封装成数据报数据报为数据部分数据报在网络传输离开时取出数据报转发数据报源目的为隧道入口出口路由器地址协议字段设为表明数据部分为数据报网际控制报文协议需反馈差错信息比复杂合并和功能因此网际层仅一个配套协议报文封装成数据报发送前面是基本首部和扩展首部前面首部的下一个首部字段置为报文可报告差错获取信息探测邻站管理多播通信常用报文类型有目的站不可达分组太长时间超过参数问题差错报告回送请求回答查询多播听众查询报告完成多播管理路由器询问通告邻站询问通告改变路由邻站发现等软件定义网络由教授于年提出最初是学术探讨的网络体系结构后被企业采用如谷歌数据中心网络能提高带宽利用率稳定性简化管理降低成本是当前网络领域热门技术',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-10-23 08:34:30',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://www.fomal.cc/static/css/runtime.min.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://pic1.imgdb.cn/item/682f3d1658cb8da5c807b704.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://www.woodfishhhh.xyz/" title="woodfishhhh博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://pic1.imgdb.cn/item/684818ef58cb8da5c8419e1e.png&quot;" data-lazy-src="/img/favicon.ico" alt="woodfishhhh博客"/><span class="back-menu-item-text">woodfishhhh博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://47.99.92.213" title="江西财经大学程序设计竞赛协会"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://pic1.imgdb.cn/item/684818ef58cb8da5c8419e1e.png&quot;" data-lazy-src="https://www.woodfishhhh.xyz/images/116983c54294980f75bc7117d81c6d1e.png?_t=1754227079323" alt="江西财经大学程序设计竞赛协会"/><span class="back-menu-item-text">江西财经大学程序设计竞赛协会</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">木鱼的鱼窝</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fas fa-home faa-tada"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><i class="fas fa-tags faa-tada"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><i class="fas fa-th faa-tada"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><i class="fas fa-link faa-tada"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><i class="fas fa-user faa-tada"></i><span> 关于我</span></a></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://www.woodfishhhh.xyz/images/e926e309585e5a5826ab0c3b485f8b6.png?_t=1751445131356" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://www.woodfishhhh.xyz/images/e926e309585e5a5826ab0c3b485f8b6.png?_t=1751445131356"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://www.woodfishhhh.xyz/images/8147e2d92fa8287fac8774305c99661.jpg.jpeg?_t=1751445131356" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://www.woodfishhhh.xyz/images/8147e2d92fa8287fac8774305c99661.jpg.jpeg?_t=1751445131356"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Ajax/" style="font-size: 1.05rem;">Ajax<sup>4</sup></a><a href="/tags/CSS/" style="font-size: 1.05rem;">CSS<sup>15</sup></a><a href="/tags/HTML/" style="font-size: 1.05rem;">HTML<sup>17</sup></a><a href="/tags/Java/" style="font-size: 1.05rem;">Java<sup>9</sup></a><a href="/tags/JavaScript/" style="font-size: 1.05rem;">JavaScript<sup>16</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>2</sup></a><a href="/tags/web/" style="font-size: 1.05rem;">web<sup>11</sup></a><a href="/tags/%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/" style="font-size: 1.05rem;">期末复习<sup>2</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/11/"><span class="card-archive-list-date">November 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/10/"><span class="card-archive-list-date">October 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">September 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/08/"><span class="card-archive-list-date">August 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">July 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">23</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">June 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">11</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">May 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"></span></div></div><h1 class="post-title" itemprop="name headline">无题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-10-21T08:19:10.000Z" title="发表于 2025-10-21 16:19:10">2025-10-21</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-10-23T00:34:30.133Z" title="更新于 2025-10-23 08:34:30">2025-10-23</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">11.4k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>36分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为南昌"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>南昌</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://www.woodfishhhh.xyz/2025/10/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%88edit%EF%BC%89/"><header><h1 id="CrawlerTitle" itemprop="name headline">无题</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">woodfish</span><time itemprop="dateCreated datePublished" datetime="2025-10-21T08:19:10.000Z" title="发表于 2025-10-21 16:19:10">2025-10-21</time><time itemprop="dateCreated datePublished" datetime="2025-10-23T00:34:30.133Z" title="更新于 2025-10-23 08:34:30">2025-10-23</time></header><h2 id="4-1-网络层概述"><a href="#4-1-网络层概述" class="headerlink" title="4.1 网络层概述"></a>4.1 网络层概述</h2><p>网络层是 OSI 体系结构自下而上的第三层，核心任务是将分组从源主机经多个网络和链路传输到目的主机，主要包含分组转发、路由选择两大功能，且能向上层提供两种服务。</p>
<h3 id="4-1-1-分组转发和路由选择"><a href="#4-1-1-分组转发和路由选择" class="headerlink" title="4.1.1 分组转发和路由选择"></a>4.1.1 分组转发和路由选择</h3><ol>
<li><strong>分组转发</strong>：路由器从某接口接收分组后，依据分组首部的转发标识（可能是目的地址或连接指示）查询自身的转发表，再将分组从合适接口转发给下一跳路由器或目的主机。每个路由器都需维护转发表，例如路由器 R1 从接口 1 收到分组，根据首部转发标识 A 查询转发表，得知应从接口 2 转发。</li>
<li><strong>路由选择</strong>：源主机与目的主机间可能存在多条路径，网络层需确定选择哪条路径传分组。以主机 H1 与 H2 为例，存在 H1→R1→R2→H2 和 H1→R1→R4→R3→R2→H2 两条路径，选择依赖路由选择方式，主要有三种：<ul>
<li><strong>集中式路由选择</strong>：由网络控制中心执行路由选择，向各路由器下载路由信息。</li>
<li><strong>分布式路由选择</strong>：各路由器运行路由选择协议，相互交换路由信息并自行计算路由。</li>
<li><strong>人工路由选择</strong>：由网络运维人员手动配置路由。</li>
</ul>
</li>
<li><strong>路由表与转发表</strong>：路由选择生成路由表，仅含目的网络到下一跳的映射，需优化网络拓扑变化计算；转发表由路由表得出，结构需优化查找过程。本书讨论路由选择原理时，不严格区分二者，以路由表表述。<br>​</li>
</ol>
<table>
<thead>
<tr>
<th>功能​</th>
<th>描述​</th>
</tr>
</thead>
<tbody><tr>
<td>分组转发​</td>
<td>路由器依据分组首部信息查询转发表，将分组从合适接口转发​</td>
</tr>
<tr>
<td>路由选择​</td>
<td>确定分组从源到目的的最佳路径​</td>
</tr>
<tr>
<td>网络服务​</td>
<td>向上层提供无连接或面向连接的服务​</td>
</tr>
</tbody></table>
<h3 id="4-1-2-网络层向其上层提供的两种服务"><a href="#4-1-2-网络层向其上层提供的两种服务" class="headerlink" title="4.1.2 网络层向其上层提供的两种服务"></a>4.1.2 网络层向其上层提供的两种服务</h3><ol>
<li><strong>面向连接的虚电路服务</strong><ul>
<li><strong>核心思想</strong>：可靠通信由<strong>网络自身</strong>保证。</li>
<li><strong>通信过程</strong>：首先建立虚电路（逻辑连接，非物理连接），确保通信所需网络资源；然后双方沿虚电路发送分组，分组首部在连接建立阶段用完整目的主机地址，之后仅需携带虚电路编号；通信结束后释放虚电路。</li>
<li><strong>特点</strong>：分组按逻辑连接存储转发，若用可靠传输协议，可使分组无差错按序到达、不丢失、不重复。</li>
</ul>
</li>
<li><strong>无连接的数据报服务</strong><ul>
<li><strong>核心思想</strong>：可靠通信由<strong>用户主机</strong>保证。</li>
<li><strong>通信过程</strong>：通信前无需建立网络层连接；每个分组可走不同路径，首部需携带完整目的主机地址，分组可能误码、丢失、重复和失序；通信结束后无需释放连接。</li>
<li><strong>特点</strong>：网络中路由器结构简单、成本低。因特网采用此服务，将复杂处理功能置于边缘（用户主机及内部运输层），核心仅提供尽最大努力的分组交付功能，使网络造价低、运行灵活、适应多种应用。</li>
</ul>
</li>
<li><strong>两种服务对比</strong>：二者在思路、连接需求、目的地址使用、分组转发方式、节点故障影响、分组顺序、服务质量实现难度等方面存在明显差异，具体可参考表 4-1。在 TCP&#x2F;IP 体系结构中，网际层向上层提供无连接、尽最大努力交付的数据报服务。</li>
</ol>
<h2 id="4-2-网际协议（IP）"><a href="#4-2-网际协议（IP）" class="headerlink" title="4.2 网际协议（IP）"></a>4.2 网际协议（IP）</h2><p>网际协议 IP 是 TCP&#x2F;IP 体系结构网络层的核心协议，本节介绍的是 IPv4，与 IP 配套使用的有 ARP、RARP、ICMP、IGMP 四个协议，其中 RARP 已淘汰。</p>
<h3 id="4-2-1-异构网络互连"><a href="#4-2-1-异构网络互连" class="headerlink" title="4.2.1 异构网络互连"></a>4.2.1 异构网络互连</h3><ol>
<li><strong>异构网络特点</strong>：因特网由众多拓扑、性能、协议不同的网络通过路由器互连，因用户需求多样，无单一网络能适应所有需求。</li>
<li><strong>互连问题</strong>：异构网络互连需解决不同的网络接入机制、差错恢复方法、路由选择技术、寻址方案、最大分组长度、服务类型等问题。</li>
<li><strong>IP 网概念</strong>：各异构网络的网络层使用相同的 IP 协议，从网络层看如同统一的 IP 网。IP 网上主机通信时，无需关注各网络异构细节，如同在单个网络通信。</li>
</ol>
<h3 id="4-2-2-IPv4-地址及其编址方法"><a href="#4-2-2-IPv4-地址及其编址方法" class="headerlink" title="4.2.2 IPv4 地址及其编址方法"></a>4.2.2 IPv4 地址及其编址方法</h3><p>表示方法​<br><strong>采用点分十进制表示法：​</strong></p>
<ul>
<li>将 32 比特地址每 8 比特为一组​</li>
<li>转换为十进制数，组间用 “.” 分隔​</li>
<li>示例：00001010 11110000 00001111 10101010 → <a target="_blank" rel="noopener" href="http://10.240.15.170/">10.240.15.170</a>​</li>
</ul>
<table>
<thead>
<tr>
<th>类别​</th>
<th>首比特​</th>
<th>网络号长度​</th>
<th>主机号长度​</th>
<th>地址范围​</th>
<th>默认子网掩码​</th>
</tr>
</thead>
<tbody><tr>
<td>A 类​</td>
<td>0​</td>
<td>8 比特​</td>
<td>24 比特​</td>
<td>1.0.0.0-127.255.255.255​</td>
<td>255.0.0.0​</td>
</tr>
<tr>
<td>B 类​</td>
<td>10​</td>
<td>16 比特​</td>
<td>16 比特​</td>
<td>128.0.0.0-191.255.255.255​</td>
<td>255.255.0.0​</td>
</tr>
<tr>
<td>C 类​</td>
<td>110​</td>
<td>24 比特​</td>
<td>8 比特​</td>
<td>192.0.0.0-223.255.255.255​</td>
<td>255.255.255.0​</td>
</tr>
<tr>
<td>D 类​</td>
<td>1110​</td>
<td>-​</td>
<td>-​</td>
<td>224.0.0.0-239.255.255.255​</td>
<td>-​</td>
</tr>
<tr>
<td>E 类​</td>
<td>1111​</td>
<td>-​</td>
<td>-​</td>
<td>240.0.0.0-255.255.255.255​</td>
<td>-​</td>
</tr>
<tr>
<td><strong>划分子网（Subnetting）​</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>目的： 解决分类编址地址浪费问题​</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>**地址结构变化：</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<ul>
<li><strong>分类编址</strong>：网络号 + 主机号（两级结构）​</li>
<li><strong>划分子网</strong>：网络号 + 子网号 + 主机号（三级结构）​<br>子网掩码：32 比特，连续 1 对应网络号和子网号，连续 0 对应主机号​</li>
</ul>
<p><strong>无分类编址</strong>（CIDR）​<br>特点：​</p>
<ul>
<li>消除分类编址和划分子网概念​</li>
<li>地址结构：网络前缀 + 主机号（两级结构）​</li>
<li>网络前缀不定长​</li>
<li>使用斜线记法：地址&#x2F;网络前缀比特数</li>
</ul>
<h3 id="4-2-3-IPv4-地址的应用规划"><a href="#4-2-3-IPv4-地址的应用规划" class="headerlink" title="4.2.3 IPv4 地址的应用规划"></a>4.2.3 IPv4 地址的应用规划</h3><p>IPv4 地址应用规划是将给定地址块（或分类网络）划分为更小地址块（或子网），分配给不同网络，再给主机和路由器接口分配地址，主要有两种方法：</p>
<ol>
<li><strong>定长的子网掩码（FLSM）</strong>：划分的每个子网用同一子网掩码，地址数量相同，易造成地址浪费。例如 C 类网络 218.75.230.0，按需求借用 3 比特作为子网号，划分为 8 个子网，每个子网 32 个地址，分配给不同网络时，部分网络可能用不完地址。</li>
<li><strong>变长的子网掩码（VLSM）</strong>：每个子网可使用不同子网掩码，地址数量按需分配，减少地址浪费。例如 CIDR 地址块 218.75.230.0&#x2F;24，根据各网络地址需求，分别划分出 &#x2F; 27、&#x2F;28、&#x2F;30 等不同前缀长度的地址块分配，满足不同网络需求，避免浪费。</li>
</ol>
<h3 id="4-2-4-IPv4-地址与-MAC-地址"><a href="#4-2-4-IPv4-地址与-MAC-地址" class="headerlink" title="4.2.4 IPv4 地址与 MAC 地址"></a>4.2.4 IPv4 地址与 MAC 地址</h3><ol>
<li><strong>封装位置</strong>：IP 地址是网际层及以上各层使用的地址，封装在 IP 数据报首部；MAC 地址（硬件 &#x2F; 物理地址）是数据链路层使用的地址，封装在帧首部。</li>
<li><strong>传送过程中变化</strong>：分组传输时，源 IP 地址和目的 IP 地址始终不变，源 MAC 地址和目的 MAC 地址逐网络（或逐链路）变化。例如主机 H1 给 H2 发送分组，经 R1、R2 转发，H1 到 R1，帧的源 MAC 是 H1 的 MAC，目的 MAC 是 R1 的 MAC；R1 到 R2，帧的源 MAC 是 R1 转发接口的 MAC，目的 MAC 是 R2 的 MAC；R2 到 H2，帧的源 MAC 是 R2 转发接口的 MAC，目的 MAC 是 H2 的 MAC，而 IP 数据报的源 IP 和目的 IP 始终是 H1 和 H2 的 IP。</li>
<li><strong>二者关系</strong>：仅用 MAC 地址通信会导致路由器路由表需记录海量 MAC 地址，配置和维护困难，且占用大量通信资源和存储空间，增加分组转发时延。网际层用 IP 地址寻址，减少路由表条目，但需地址解析协议获取下一跳的 MAC 地址，以完成数据链路层帧的封装。</li>
</ol>
<h3 id="4-2-5-地址解析协议"><a href="#4-2-5-地址解析协议" class="headerlink" title="4.2.5 地址解析协议"></a>4.2.5 地址解析协议</h3><ol>
<li><strong>ARP 协议</strong>：功能是通过已知 IP 地址找到对应的 MAC 地址。主机维护 ARP 高速缓存表，记录 IP 与 MAC 地址对应关系（分动态和静态，动态由 ARP 自动获取，生命周期默认 2 分钟；静态由人工配置）。当主机要给其他主机发送分组，先查 ARP 高速缓存表，未找到则发送 ARP 请求报文（广播，含自身 IP、MAC 及目标 IP），目标主机收到后，记录发送方 IP 与 MAC 到自身缓存表，再发送 ARP 响应报文（单播，含自身 IP、MAC），发送方收到后更新自身缓存表，即可进行分组发送。ARP 协议仅在同一局域网使用，跨网络通信时，需在各段链路分别使用 ARP。</li>
<li><strong>RARP 协议</strong>：功能是使仅知自身 MAC 地址的主机找出 IP 地址，现因 DHCP 协议包含其功能，已不再使用。</li>
<li><strong>ARP 协议归属</strong>：有的教材将其划归网际层，有的划归数据链路层，均合理。除请求和响应报文，还有无故 ARP 等类型报文，且 ARP 协议无安全验证机制，存在欺骗和攻击问题。</li>
</ol>
<h3 id="4-2-6-IP-数据报的发送和转发过程"><a href="#4-2-6-IP-数据报的发送和转发过程" class="headerlink" title="4.2.6 IP 数据报的发送和转发过程"></a>4.2.6 IP 数据报的发送和转发过程</h3><ol>
<li><strong>主机发送 IP 数据报</strong><ul>
<li><strong>直接交付</strong>：同一网络中主机通信，源主机通过 ARP 获取目的主机 MAC 地址，将 IP 数据报封装成帧发送。判断是否同一网络，需将自身和目的主机 IP 地址的网络前缀保持不变，主机号清零，若得到的网络地址相同，则为同一网络。</li>
<li><strong>间接交付</strong>：不同网络中主机通信，源主机通过 ARP 获取默认网关（路由器）MAC 地址，将 IP 数据报封装成帧发送给默认网关，由网关转发。</li>
</ul>
</li>
<li><strong>路由器转发 IP 数据报</strong>：路由器收到正确 IP 数据报（TTL 未结束、首部无误码）后，根据目的 IP 地址查询路由表。查到匹配条目则按指示转发；查不到则丢弃，并向源主机发送差错报告。例如主机 A 给 D 发送 IP 数据报，路由器 R 收到后，将目的 IP 与路由表中地址掩码逐比特逻辑与运算，找到匹配的目的网络条目，从对应接口转发给 D。路由器不转发目的地址为广播地址的 IP 数据报，以隔离广播域，避免广播风暴。</li>
</ol>
<h3 id="4-2-7-IPv4-数据报的首部格式"><a href="#4-2-7-IPv4-数据报的首部格式" class="headerlink" title="4.2.7 IPv4 数据报的首部格式"></a>4.2.7 IPv4 数据报的首部格式</h3><p>IPv4 数据报首部由 20 字节固定部分和最大 40 字节可变部分组成，各字段含义如下：</p>
<ol>
<li><strong>版本</strong>：4 比特，表 IP 协议版本，目前为 4（IPv4）。</li>
<li><strong>首部长度、可选字段和填充</strong>：首部长度 4 比特，以 4 字节为单位，最小 5（20 字节固定部分），最大 15（20 字节固定 + 40 字节可变）；可选字段 1-40 字节，支持排错、测量等功能，较少使用；填充字段用全 0 填充，确保首部长度为 4 字节整数倍。</li>
<li><strong>区分服务</strong>：8 比特，旧称服务类型，现用于提供不同服务质量，一般不使用。</li>
<li><strong>总长度</strong>：16 比特，以字节为单位，表 IP 数据报总长度（首部 + 数据载荷），最大 65535 字节。</li>
<li><strong>标识、标志和片偏移</strong>：共同用于数据报分片。标识 16 比特，同一数据报的分片标识相同；标志 3 比特，最低位 MF（1 表后面有分片，0 表无），中间位 DF（1 表不允许分片，0 表允许），最高位保留为 0；片偏移 13 比特，以 8 字节为单位，表分片数据载荷偏移原数据报的位置。</li>
<li><strong>生存时间（TTL）</strong>：8 比特，最初以秒为单位，现以跳数为单位，源主机设置初始值，路由器转发时减 1，为 0 则丢弃，防止数据报无限兜圈。</li>
<li><strong>协议</strong>：8 比特，指明数据载荷的协议类型，如 6 对应 TCP，17 对应 UDP 等。</li>
<li><strong>首部检验和</strong>：16 比特，检测首部传输差错，路由器转发时需重新计算。计算方法为发送方将首部划分为 16 比特字序列，检验和字段置 0，反码算术求和后取反码写入；接收方重新求和取反码，结果为 0 则无差错，否则丢弃。</li>
<li><strong>源 IP 地址和目的 IP 地址</strong>：各 32 比特，分别表发送方和接收方 IP 地址。</li>
</ol>
<h2 id="4-3-静态路由配置"><a href="#4-3-静态路由配置" class="headerlink" title="4.3 静态路由配置"></a>4.3 静态路由配置</h2><p>静态路由配置是人工给路由器配置路由表，简单、开销小，但不能适应网络状态变化，适用于小规模网络。</p>
<h3 id="4-3-1-直连路由和非直连路由"><a href="#4-3-1-直连路由和非直连路由" class="headerlink" title="4.3.1 直连路由和非直连路由"></a>4.3.1 直连路由和非直连路由</h3><ol>
<li><strong>直连路由</strong>：路由器给各接口配置 IP 地址和地址掩码后，自行得出各接口直连网络的路由条目，记录在路由表中。</li>
<li><strong>非直连路由</strong>：路由器到其他非直连网络的路由，由人工配置（静态路由）或通过路由选择协议自动获取（动态路由）。例如路由器 R1 的接口 0、1 直连网络，对应路由条目为直连路由；到 R2 直连的另一网络的路由条目，由人工配置，为非直连路由。</li>
</ol>
<h3 id="4-3-2-默认路由和特定主机路由"><a href="#4-3-2-默认路由和特定主机路由" class="headerlink" title="4.3.2 默认路由和特定主机路由"></a>4.3.2 默认路由和特定主机路由</h3><ol>
<li><strong>默认路由</strong>：若路由器查不到匹配路由条目，按默认路由转发。默认路由条目目的网络为 0.0.0.0&#x2F;0，匹配优先级最低（最长前缀匹配原则），可减少路由表存储和查找时间。例如路由器 R1 到因特网的路由，配置默认路由，下一跳为 R2，无需配置到因特网各网络的路由条目。</li>
<li><strong>特定主机路由</strong>：针对某一台主机的路由，目的网络为该主机 IP&#x2F;32，匹配优先级最高，用于安全控制、网络测试和排错。例如路由器 R1 到主机 192.168.2.1 的路由，配置特定主机路由，下一跳为 R2。配置静态路由需谨慎，避免路由环路。</li>
</ol>
<h2 id="4-4-因特网的路由选择协议"><a href="#4-4-因特网的路由选择协议" class="headerlink" title="4.4 因特网的路由选择协议"></a>4.4 因特网的路由选择协议</h2><h3 id="4-4-1-路由选择分类"><a href="#4-4-1-路由选择分类" class="headerlink" title="4.4.1 路由选择分类"></a>4.4.1 路由选择分类</h3><ol>
<li><strong>静态路由选择</strong>：人工配置路由条目，简单、开销小，但不适应网络状态变化，适用于小规模网络。</li>
<li><strong>动态路由选择</strong>：路由器通过路由选择协议自动获取路由信息，复杂、开销大，但能适应网络状态变化，适用于大规模网络。</li>
</ol>
<h3 id="4-4-2-因特网采用分层次的路由选择协议"><a href="#4-4-2-因特网采用分层次的路由选择协议" class="headerlink" title="4.4.2 因特网采用分层次的路由选择协议"></a>4.4.2 因特网采用分层次的路由选择协议</h3><ol>
<li><strong>特点</strong>：自适应（动态路由，适应网络状态变化）、分布式（各路由器交换信息，共同完成路由获取和更新）、分层次（将因特网划分为自治系统 AS，AS 内和 AS 间用不同路由选择协议）。</li>
<li><strong>路由选择协议分类</strong><ul>
<li><strong>内部网关协议（IGP）</strong>：用于 AS 内路由选择，各 AS 可选择不同 IGP，如 RIP、OSPF。</li>
<li><strong>外部网关协议（EGP）</strong>：用于 AS 间路由选择（域间路由选择），如 BGP。早期 RFC 用 “网关”，现新文档用 “路由器”，二者称呼均可。</li>
</ul>
</li>
</ol>
<h3 id="4-4-3-路由信息协议（RIP）"><a href="#4-4-3-路由信息协议（RIP）" class="headerlink" title="4.4.3 路由信息协议（RIP）"></a>4.4.3 路由信息协议（RIP）</h3><ol>
<li><strong>基本概念</strong>：是早期广泛使用的 IGP，标准文档 RFC 1058，基于距离向量算法，用跳数衡量到目的网络的距离（直连网络距离 1，非直连为经过路由器数 + 1），最大跳数 15（16 表不可达），适用于小型互联网。认为跳数少的路由是好路由，可进行等价负载均衡。仅与相邻路由器周期性（约 30 秒）交换自身路由表信息，网络拓扑变化时触发更新，加快收敛。</li>
<li><strong>工作过程</strong>：路由器初始仅知直连网络路由；与相邻路由器周期性交换更新路由信息；多次交换更新后，各路由器知晓 AS 内各网络最短距离和下一跳，实现收敛。</li>
<li><strong>距离向量算法</strong>：路由器收到相邻路由器路由更新报文后，修改报文（下一跳改为该路由器，距离加 1），再更新自身路由表，更新规则包括：相同下一跳，无论距离变化均更新；发现新网络，添加路由条目；不同下一跳，新路由距离更小则更新；不同下一跳，新路由距离相同则添加条目（等价负载均衡）；不同下一跳，新路由距离更大则不更新。还包含时间参数，如 30 秒发送更新报文，180 秒未收更新则标记路由无效，再 120 秒未收则删除该路由。</li>
<li><strong>存在问题</strong>：“坏消息传播得慢”，易形成路由环路，可持续数分钟。可通过限制最大跳数、触发更新、水平分割等措施减少问题概率或危害，但无法彻底解决，因路由器缺少目的网络完整路径信息，无法判断路由是否环路。</li>
<li><strong>版本和报文</strong>：最新版本 RIP2（RFC 2453），支持 VLSM、CIDR、鉴别和多播。RIP 报文用 UDP（端口 520）传送，属应用层，但核心功能属网际层。</li>
<li><strong>优缺点</strong>：优点是实现简单、路由器开销小，好消息传播快；缺点是限制最大跳数，网络规模受限，相邻路由器交换完整路由表，网络规模扩大时开销增加，坏消息传播慢，收敛时间长，大规模 AS 应使用 OSPF，小规模 AS 仍常用 RIP。</li>
</ol>
<h3 id="4-4-4-开放最短路径优先协议（OSPF）"><a href="#4-4-4-开放最短路径优先协议（OSPF）" class="headerlink" title="4.4.4 开放最短路径优先协议（OSPF）"></a>4.4.4 开放最短路径优先协议（OSPF）</h3><ol>
<li><strong>基本概念</strong>：1989 年开发，克服 RIP 缺点，“开放” 指协议公开发表，“最短路径优先” 因使用 Dijkstra 算法。基于链路状态（路由器相邻关系及链路代价，代价由网络管理人员决定，如思科路由器用 100Mb&#x2F;s 除以链路带宽计算），无路由环路，不限制网络规模，更新效率高，收敛快。</li>
<li><strong>关键机制</strong><ul>
<li><strong>邻居关系建立和维护</strong>：相邻路由器通过 Hello 分组（封装在 IP 数据报，发往组播地址 224.0.0.5，协议号 89）建立和维护邻居关系，Hello 分组发送周期 10 秒，40 秒未收则认为邻居不可达，主机建立邻居表。</li>
<li><strong>链路状态通告（LSA）</strong>：每个路由器产生 LSA，含直连网络和邻居路由器的链路状态信息。</li>
<li><strong>链路状态更新分组（LSU）</strong>：LSA 封装在 LSU 中，用洪泛法发送，使各路由器链路状态数据库（LSDB）一致。</li>
<li><strong>链路状态数据库（LSDB）</strong>：存储 LSA，各路由器 LSDB 一致后，基于 Dijkstra 算法计算最短路径，构建路由表。</li>
</ul>
</li>
<li><strong>分组类型</strong>：共五种，分别是问候（Hello）分组（发现和维护邻居可达性）、数据库描述分组（给邻居发送 LSDB 摘要）、链路状态请求分组（请求邻居发送特定 LSA 详细信息）、链路状态更新分组（洪泛发送 LSA）、链路状态确认分组（确认 LSU）。</li>
<li><strong>工作过程</strong>：相邻路由器交换 Hello 分组，建立邻居关系；发送数据库描述分组，共享 LSDB 摘要；根据缺少的 LSA，发送链路状态请求分组；邻居发送 LSU，请求方更新 LSDB 并发送确认；LSDB 同步后，路由器基于 LSDB 计算路由表。每 30 分钟或链路状态变化时，洪泛发送 LSU，更新 LSDB。</li>
<li><strong>多点接入网络优化</strong>：选举指定路由器（DR）和备用指定路由器（BDR），普通路由器仅与 DR、BDR 建立邻居关系，减少分组发送数量。DR 故障时，BDR 顶替。</li>
<li><strong>区域划分</strong>：将 AS 划分为多个区域，主干区域（标识 0）连通其他区域，各区域有区域边界路由器（连接自身区域和主干区域）、区域内路由器（所有接口在同一区域）、主干路由器（主干区域内路由器，含区域边界路由器）、自治系统边界路由器（主干区域内与其他 AS 交换路由信息的路由器）。区域划分将洪泛范围局限于区域，减少通信量。</li>
</ol>
<h3 id="4-4-5-边界网关协议（BGP）"><a href="#4-4-5-边界网关协议（BGP）" class="headerlink" title="4.4.5 边界网关协议（BGP）"></a>4.4.5 边界网关协议（BGP）</h3><ol>
<li><strong>基本概念</strong>：属 EGP，用于 AS 间路由选择。因不同 AS 度量路由 “代价” 不同，且需考虑政治、经济、安全等策略，BGP 不寻找最佳路由，仅寻找能到达目的网络且无环路的较好路由。</li>
<li><strong>BGP 边界路由器</strong>：每个 AS 选择至少一个路由器作为 BGP 发言人（常为边界路由器），不同 AS 的 BGP 发言人通过建立 TCP 连接（端口 179），进行 BGP 会话，交换路由信息（网络可达性，即到达网络需经过的 AS 序列），构建无环路的 AS 连通图。BGP 发言人还需运行所在 AS 的 IGP（如 RIP、OSPF）。</li>
<li><strong>BGP-4 报文</strong>：共四种，OPEN 报文（建立 BGP 关系，初始化通信）、UPDATE 报文（通告路由信息，撤销过时路由）、KEEPALIVE 报文（周期性证实邻站连通性，约 30 秒发送，仅 19 字节）、NOTIFICATION 报文（发送差错信息）。RFC 2918 增加 ROUTE-REFRESH 报文（请求对等方重新通告路由）。初始交换完整路由表，后续仅更新变化部分。</li>
</ol>
<h3 id="4-4-6-路由器的基本工作原理"><a href="#4-4-6-路由器的基本工作原理" class="headerlink" title="4.4.6 路由器的基本工作原理"></a>4.4.6 路由器的基本工作原理</h3><p>路由器是有多个输入、输出端口的专用计算机，任务是转发分组，分为路由选择和分组转发两部分。</p>
<ol>
<li><strong>路由选择部分</strong>：核心是路由选择处理机，根据路由选择协议，周期性与其他路由器交换路由信息，构建和更新路由表。</li>
<li><strong>分组转发部分</strong>：由输入端口、交换结构、输出端口组成。信号从输入端口进入，物理层转比特流给数据链路层，数据链路层识别帧，去帧头帧尾给网络层：<ul>
<li>若为普通待转发数据分组，网络层根据目的地址查转发表，更新分组首部（如 TTL 减 1），交数据链路层封装成帧，物理层发送。</li>
<li>若为路由分组，交路由选择处理机，更新路由表，路由选择处理机还会周期性发送路由信息。</li>
</ul>
</li>
<li><strong>缓冲区</strong>：各端口有输入缓冲区（暂存待处理分组）和输出缓冲区（暂存待发送分组）。</li>
<li><strong>交换结构</strong>：是关键构件，实现分组从输入端口到输出端口的转发，有通过存储器、总线、互连网络三种实现方式，转发速率依次提高。</li>
</ol>
<h2 id="4-5-网际控制报文协议（ICMP）"><a href="#4-5-网际控制报文协议（ICMP）" class="headerlink" title="4.5 网际控制报文协议（ICMP）"></a>4.5 网际控制报文协议（ICMP）</h2><p>为有效转发 IP 数据报、提高交付成功率，TCP&#x2F;IP 体系结构网际层使用 ICMP，主机或路由器用其发送差错报告和询问报文，ICMP 报文封装在 IP 数据报中发送。</p>
<h3 id="4-5-1-ICMP-报文的种类"><a href="#4-5-1-ICMP-报文的种类" class="headerlink" title="4.5.1 ICMP 报文的种类"></a>4.5.1 ICMP 报文的种类</h3><ol>
<li><strong>ICMP 差错报告报文</strong>：用于报告差错情况，共五种：<ul>
<li><strong>终点不可达</strong>：路由器或主机不能交付 IP 数据报时发送，细分为目的网络、主机、协议、端口不可达等 13 种错误。例如路由器 R1 路由表无 H2 所在网络路由，收到 H1 给 H2 的 IP 数据报后，丢弃并发送终点不可达报文给 H1。</li>
<li><strong>源点抑制</strong>：路由器或主机因拥塞丢弃 IP 数据报时发送，使源主机降低发送速率。例如路由器 R2 拥塞，丢弃 H1 给 H2 的 IP 数据报，发送源点抑制报文给 H1。</li>
<li><strong>时间超过（超时）</strong>：路由器转发 IP 数据报时，TTL 减 1 为 0 则丢弃并发送；终点未在规定时间收到全部数据报片，丢弃已收片并发送。例如 H1 发送 TTL&#x3D;2 的 IP 数据报，经 R1（TTL&#x3D;1）、R2（TTL&#x3D;0），R2 丢弃并发送时间超过报文给 H1。</li>
<li><strong>参数问题</strong>：路由器或目的主机收到 IP 数据报，首部检验和出错则丢弃并发送。例如 H1 给 H2 的 IP 数据报首部受干扰出错，R1 检测到后丢弃并发送参数问题报文给 H1。</li>
<li><strong>改变路由（重定向）</strong>：路由器告知主机下次应将数据报发送给其他路由器，以选择更好路由。例如 H1 默认网关为 R1，R1 发现 H1 发往 N2 的最佳路由经 R4，发送改变路由报文给 H1，H1 更新路由表。</li>
<li><strong>不发送 ICMP 差错报告报文的情况</strong>：对 ICMP 差错报告报文不发送；对第一个分片后续的分片不发送；对多播地址的 IP 数据报不发送；对特殊地址（如 127.0.0.0、0.0.0.0）的数据报不发送。</li>
</ul>
</li>
<li><strong>ICMP 询问报文</strong>：常用的有回送请求和回答（测试目的站可达性及状态）、时间戳请求和回答（请求日期时间，用于时钟同步和时间测量）。</li>
</ol>
<h3 id="4-5-2-ICMP-的典型应用"><a href="#4-5-2-ICMP-的典型应用" class="headerlink" title="4.5.2 ICMP 的典型应用"></a>4.5.2 ICMP 的典型应用</h3><ol>
<li><strong>分组网间探测（PING）</strong>：测试主机或路由器连通性，应用层直接使用 ICMP，不使用 TCP 或 UDP，用回送请求和回答报文。例如 PC 发送 4 个 ICMP 回送请求报文给服务器，收到 4 个回送回答报文，可得出连通性和往返时间，部分主机 &#x2F; 服务器可能不理睬该报文以防攻击。</li>
<li><strong>跟踪路由</strong><ul>
<li><strong>工具</strong>：UNIX 中为 “traceroute”（用 UDP，ICMP 差错报告报文），Windows 中为 “tracert”（直接用 ICMP，回送请求、回答及差错报告报文）。</li>
<li><strong>tracert 原理</strong>：主机发送 ICMP 回送请求报文，TTL 依次设为 1、2、3…，TTL&#x3D;1 时，第一台路由器收到后 TTL 减为 0，丢弃并发送时间超过报文，主机知第一台路由器；TTL&#x3D;2 时，第二台路由器收到后 TTL 减为 0，丢弃并发送时间超过报文，主机知第二台路由器；直至 TTL 足够大，目的主机收到后发送回送回答报文，主机知到达目的主机。例如 H1 跟踪到 H2 的路由，依次发送 TTL&#x3D;1、2、3 的报文，获取各路由器 IP 地址。</li>
</ul>
</li>
</ol>
<h2 id="4-6-虚拟专用网（VPN）和网络地址转换（NAT）"><a href="#4-6-虚拟专用网（VPN）和网络地址转换（NAT）" class="headerlink" title="4.6 虚拟专用网（VPN）和网络地址转换（NAT）"></a>4.6 虚拟专用网（VPN）和网络地址转换（NAT）</h2><h3 id="4-6-1-虚拟专用网（VPN）"><a href="#4-6-1-虚拟专用网（VPN）" class="headerlink" title="4.6.1 虚拟专用网（VPN）"></a>4.6.1 虚拟专用网（VPN）</h3><ol>
<li><strong>概念引入</strong>：远程专用网通信有两种方式，租用电信线路（简单但费用高）或利用因特网作为载体（即 VPN，成本低）。专用网内主机用专用地址（RFC 1918 规定 10.0.0.0<del>10.255.255.255、172.16.0.0</del>172.31.255.255、192.168.0.0~192.168.255.255），仅在机构内部有效，因特网路由器不转发目的地址为专用地址的 IP 数据报。</li>
<li><strong>工作原理</strong>：专用网需至少一个路由器有全球 IP 地址，进行 VPN 配置。源主机发送内部 IP 数据报给路由器，路由器加密内部 IP 数据报，重新封装成外部 IP 数据报（源、目的为路由器全球 IP），通过因特网发送给目的专用网路由器；目的路由器解密，提取内部 IP 数据报，发送给目的主机。VPN 逻辑上像专用网通信，使用 IP 隧道技术。</li>
<li><strong>VPN 类型</strong>：内联网 VPN（同一机构内不同部门专用网构成）、外联网 VPN（机构 VPN 包含外部合作伙伴）、远程接入 VPN（外地员工通过因特网访问公司专用网）。</li>
</ol>
<h3 id="4-6-2-网络地址转换（NAT）"><a href="#4-6-2-网络地址转换（NAT）" class="headerlink" title="4.6.2 网络地址转换（NAT）"></a>4.6.2 网络地址转换（NAT）</h3><ol>
<li><strong>背景</strong>：为缓解 IPv4 地址耗尽问题，1994 年提出，使大量用内部专用地址的主机共享少量外部全球地址访问因特网，需在专用网连接因特网的路由器（NAT 路由器）上安装 NAT 软件，NAT 路由器至少有一个全球 IP。</li>
<li><strong>基本 NAT 方法</strong>：源主机给外部主机发送 IP 数据报，NAT 路由器从全球地址池选临时全球地址，修改数据报源地址，记录内部 IP 与全球 IP 对应关系，转发数据报；外部主机发回数据报，NAT 路由器根据对应关系，修改目的地址为内部 IP，转发给源主机。缺点是 NAT 路由器有 n 个全球 IP，专用网最多 n 台主机同时接入因特网。</li>
<li><strong>网络地址与端口号转换（NAPT）</strong>：结合运输层端口号，使大量内部主机共用 1 个全球 IP。NAPT 路由器收到内部主机 IP 数据报，修改源地址为全球 IP，修改运输层源端口号，记录内部 IP: 端口与全球 IP: 端口对应关系，转发数据报；收到外部主机数据报，根据对应关系，修改目的地址和端口号，转发给内部主机。NAPT 对部分网络应用不透明，通信需由专用网内部发起，内部主机不能直接充当因特网服务器，P2P 应用需 NAT 穿透技术。</li>
</ol>
<h2 id="4-7-IP-多播"><a href="#4-7-IP-多播" class="headerlink" title="4.7 IP 多播"></a>4.7 IP 多播</h2><h3 id="4-7-1-IP-多播技术的相关基本概念"><a href="#4-7-1-IP-多播技术的相关基本概念" class="headerlink" title="4.7.1 IP 多播技术的相关基本概念"></a>4.7.1 IP 多播技术的相关基本概念</h3><p>多播（组播）是 “一对多” 通信技术，相比单播 “一对一”，可节省网络资源。IP 多播由 Steve Dering 于 1988 年提出，1992 年 3 月首次实验。例如视频服务器向 60 个主机传视频，单播需发 60 个，多播仅发 1 个，路由器按需复制，局域网利用硬件多播，多播组成员均可接收。因特网实现多播需路由器支持多播功能，涉及多播寻址和路由选择协议。</p>
<h3 id="4-7-2-IP-多播地址和多播组"><a href="#4-7-2-IP-多播地址和多播组" class="headerlink" title="4.7.2 IP 多播地址和多播组"></a>4.7.2 IP 多播地址和多播组</h3><ol>
<li><strong>多播地址</strong>：IPv4 中 D 类地址为多播地址，首 4 位 1110，剩余 28 位可变，范围 224.0.0.0~239.255.255.255，仅作目的地址。</li>
<li><strong>多播组</strong>：每个 D 类地址标识一个多播组，使用同一多播地址接收数据报的主机构成多播组，成员可动态变动，主机可属多个多播组，非成员也可向多播组发送数据报，多播数据报 “尽最大努力交付”。</li>
<li><strong>D 类地址分类</strong>：分预留多播地址（永久）、全球可用多播地址、本地管理多播地址（仅本地有效）。</li>
<li><strong>IP 多播类型</strong>：本局域网上的硬件多播、因特网上的多播，因特网上多播最后阶段需在局域网用硬件多播交付。</li>
</ol>
<h3 id="4-7-3-在局域网上进行硬件多播"><a href="#4-7-3-在局域网上进行硬件多播" class="headerlink" title="4.7.3 在局域网上进行硬件多播"></a>4.7.3 在局域网上进行硬件多播</h3><p>局域网支持硬件多播，将 IPv4 多播地址映射为多播 MAC 地址（IANA 分配 01-00-5E-00-00-00~01-00-5E-7F-FF-FF 的 MAC 地址），多播 MAC 地址首 25 比特固定，剩余 23 比特来自 D 类 IP 地址低 23 比特，导致多播 IP 与 MAC 地址映射不唯一。收到多播数据报的主机，先通过 MAC 地址判断是否属本硬件多播组，是则交网际层，网际层再根据 IP 地址判断是否属本 IP 多播组，是则接受，否则丢弃。</p>
<h3 id="4-7-4-在因特网上进行-IP-多播需要的两种协议"><a href="#4-7-4-在因特网上进行-IP-多播需要的两种协议" class="headerlink" title="4.7.4 在因特网上进行 IP 多播需要的两种协议"></a>4.7.4 在因特网上进行 IP 多播需要的两种协议</h3><p>因特网上 IP 多播需网际组管理协议（IGMP）和多播路由选择协议。IGMP 使本地局域网多播路由器知本局域网上是否有主机加入 &#x2F; 退出多播组，仅在本网络有效，不知多播组成员数量和分布；多播路由选择协议使多播路由器协同工作，为每个多播组建立多播转发树，IP 多播数据报沿树洪泛，再通过硬件多播发送给成员。</p>
<h3 id="4-7-5-网际组管理协议（IGMP）"><a href="#4-7-5-网际组管理协议（IGMP）" class="headerlink" title="4.7.5 网际组管理协议（IGMP）"></a>4.7.5 网际组管理协议（IGMP）</h3><ol>
<li><strong>基本概念</strong>：最新版本 IGMPv3（RFC 3376），有成员报告、成员查询、离开组三种报文，封装在 IP 多播数据报中发送（协议字段 &#x3D; 2，目的地址为多播地址，TTL&#x3D;1）。</li>
<li><strong>工作原理</strong><ul>
<li><strong>加入多播组</strong>：主机发送 IGMP 成员报告报文（含要加入的多播组地址，数据报目的地址为该多播组地址），同组其他成员监听到则取消发送。多播路由器收到未知多播组的报告，将该多播组地址添加到多播组列表（不记录主机 IP）。</li>
<li><strong>监视多播组成员变化</strong>：多播路由器默认每 125 秒发送 IGMP 成员查询报文（含特定多播组地址或全 0，数据报目的地址 224.0.0.1），收到的多播组成员延迟 1-10 秒随机响应，若收到同组其他成员响应则取消。长时间未收某多播组响应，将其从列表删除。同一网络多播路由器选举查询路由器（IP 地址最小）发送查询报文。</li>
<li><strong>退出多播组</strong>：IGMPv2 支持主机主动发送离开组报文（含要退出的多播组地址，数据报目的地址 224.0.0.2），多播路由器收到后，立即针对该多播组发送查询报文，预定时间未收响应则删除该多播组。</li>
</ul>
</li>
</ol>
<h3 id="4-7-6-多播路由选择协议"><a href="#4-7-6-多播路由选择协议" class="headerlink" title="4.7.6 多播路由选择协议"></a>4.7.6 多播路由选择协议</h3><p>多播路由选择协议为每个多播组建立多播转发树，有两种构建方法：</p>
<ol>
<li><strong>基于源树的多播路由选择</strong>：典型算法反向路径多播（RPM），先通过反向路径广播（RPB）建立广播转发树（避免洪泛法在环路网络的问题，检查广播分组是否从源点最短路径传来，是则转发），再用剪枝算法剪除下游非成员路由器，获得多播转发树。被剪枝路由器若又发现多播组成员，可发送嫁接报文重新加入。</li>
<li><strong>组共享树多播路由选择</strong>：用基于核心的分布式生成树算法，指定核心路由器，以其为根建立多播转发树。成员路由器向核心路由器单播加入报文，加入报文路径构成树的分支，嫁接到现有树上。</li>
<li><strong>因特网多播路由选择协议</strong>：目前无全球使用的协议，建议使用的有 DVMRP、MOSPF、PIM-SM、PIM-DM、CBT 等。IP 多播目前主要用于局部网络，应用层多播技术也在发展，多播路由选择协议算法思想仍适用。</li>
</ol>
<h2 id="4-8-移动-IP-技术"><a href="#4-8-移动-IP-技术" class="headerlink" title="4.8 移动 IP 技术"></a>4.8 移动 IP 技术</h2><h3 id="4-8-1-移动性对因特网应用的影响"><a href="#4-8-1-移动性对因特网应用的影响" class="headerlink" title="4.8.1 移动性对因特网应用的影响"></a>4.8.1 移动性对因特网应用的影响</h3><ol>
<li><strong>无影响场景</strong>：主机在同一 Wi-Fi 服务区移动（IP 不变）；主机在不同地点关机后重新上网（通过 DHCP 获取新 IP，对用户透明）。</li>
<li><strong>有影响场景</strong>：主机在不同网络间移动且需不间断通信（如汽车中下载视频），因切换网络导致 IP 变化，应用程序无法向变动 IP 的主机发送数据。IP 地址指明主机及所在网络，移动主机切换网络必变 IP，否则数据报仍路由到原网络。</li>
</ol>
<h3 id="4-8-2-移动-IP-技术的相关基本概念"><a href="#4-8-2-移动-IP-技术的相关基本概念" class="headerlink" title="4.8.2 移动 IP 技术的相关基本概念"></a>4.8.2 移动 IP 技术的相关基本概念</h3><p>移动 IP（RFC 3344）使移动主机在网络间漫游时保持原 IP 不变，且非移动主机可正确向其发送数据报，无需改变非移动主机软件和多数路由器工作方式。</p>
<ol>
<li><strong>归属网络、归属地址（永久地址）、归属代理</strong>：归属网络是移动主机默认连接或初始接入的网络；归属地址是移动主机在归属网络的 IP，通信中不变；归属代理是归属网络中执行移动管理功能的实体（通常是路由器，功能在应用层完成）。</li>
<li><strong>外地网络（被访网络）、外地代理、转交地址</strong>：外地网络是移动主机当前漫游的网络；外地代理是外地网络中帮助移动主机执行移动管理功能的实体（通常是路由器）；转交地址是外地代理为移动主机提供的临时外地网络地址。</li>
<li><strong>工作过程</strong>：移动主机漫游到外地网络，归属代理代收其数据报，用转交地址通过 IP-in-IP 隧道转发给外地代理，外地代理再转发给移动主机，对固定主机透明。</li>
</ol>
<h3 id="4-8-3-移动-IP-技术的基本工作原理"><a href="#4-8-3-移动-IP-技术的基本工作原理" class="headerlink" title="4.8.3 移动 IP 技术的基本工作原理"></a>4.8.3 移动 IP 技术的基本工作原理</h3><ol>
<li><strong>代理发现与注册</strong>：移动主机漫游到外地网络，通过代理发现协议与外地代理建立联系，获取转交地址并注册；外地代理向归属代理注册移动主机转交地址；归属代理记录转交地址，代收并转发数据报。</li>
<li><strong>固定主机向移动主机发送 IP 数据报</strong>：固定主机发送数据报（目的为移动主机归属地址），路由到归属网络，归属代理代收，封装成新 IP 数据报（目的为转交地址），通过 IP 隧道发送给外地代理；外地代理解封，转发给移动主机。归属代理用 ARP 代理技术代收数据报，转交地址可为外地代理地址（多主机共享），外地代理通过记录移动主机永久地址与 MAC 地址对应关系转发数据报。</li>
<li><strong>移动主机向固定主机发送 IP 数据报</strong>：移动主机发送数据报（源为归属地址，目的为固定主机 IP），按正常流程发送，将外地代理或外地网络路由器设为默认网关，无需经归属代理转发。</li>
<li><strong>同址转交地址</strong>：外地代理可运行在移动主机上，此时转交地址为同址转交地址（既是外地代理也是移动主机地址），移动主机需通过 DHCP 获取外地网络地址，运行外地代理软件。</li>
<li><strong>三角形路由问题</strong>：固定主机向移动主机发送数据报需经归属代理转发，可能存在低效路径（如固定主机与移动主机在同一外地网络）。解决方法是固定主机配置通信代理，从归属代理获取移动主机转交地址，直接通过隧道发送，但增加复杂性且对固定主机不透明。</li>
</ol>
<h3 id="4-8-4-蜂窝移动通信网中的移动性管理"><a href="#4-8-4-蜂窝移动通信网中的移动性管理" class="headerlink" title="4.8.4 蜂窝移动通信网中的移动性管理"></a>4.8.4 蜂窝移动通信网中的移动性管理</h3><p>蜂窝移动通信网更早支持移动性，用户手机漫游用同一电话号码，通话不中断，采用类似移动 IP 但更复杂的机制。CDMA2000 分组域核心网络支持用移动 IP 为数据业务提供移动性服务，其他 3G 标准在 IP 层以下提供，且仅在网络内部提供移动性服务。目前移动 IP 未在全球因特网大规模使用。</p>
<h2 id="4-9-下一代网际协议-IPv6"><a href="#4-9-下一代网际协议-IPv6" class="headerlink" title="4.9 下一代网际协议 IPv6"></a>4.9 下一代网际协议 IPv6</h2><h3 id="4-9-1-IPv6-引进的主要变化"><a href="#4-9-1-IPv6-引进的主要变化" class="headerlink" title="4.9.1 IPv6 引进的主要变化"></a>4.9.1 IPv6 引进的主要变化</h3><p>IPv4 地址设计缺陷导致地址耗尽，2011 年 IANA 宣布 IPv4 地址分配完毕，我国 2014-2015 年停止分配并部署 IPv6。IPv6 支持无连接、尽最大努力交付，称协议数据单元为分组，本书仍称 IP 数据报。主要变化：</p>
<ol>
<li><strong>更大地址空间</strong>：地址长度从 32 比特增至 128 比特，地址空间极大，可预见未来不会用完。</li>
<li><strong>扩展的地址层次结构</strong>：地址空间大，可划分更多层次，反映因特网拓扑，优化寻址和路由设计。</li>
<li><strong>灵活的首部格式</strong>：首部与 IPv4 不兼容，定义可选扩展首部，提高路由器处理效率（仅处理逐跳扩展首部）。</li>
<li><strong>改进的选项</strong>：允许数据报含选项控制信息，可添加新选项，IPv4 选项固定。</li>
<li><strong>允许协议继续扩充</strong>：适应技术发展和新应用出现，IPv4 功能固定。</li>
<li><strong>支持即插即用（自动配置）</strong>：主机或路由器自动配置 IPv6 地址及网络参数，无需 DHCP。</li>
<li><strong>支持资源预分配</strong>：为实时音视频等应用提供更好服务质量保证。</li>
</ol>
<h3 id="4-9-2-IPv6-数据报的基本首部"><a href="#4-9-2-IPv6-数据报的基本首部" class="headerlink" title="4.9.2 IPv6 数据报的基本首部"></a>4.9.2 IPv6 数据报的基本首部</h3><p>IPv6 数据报由 40 字节基本首部和可变长度有效载荷（含零个或多个扩展首部及数据部分）组成。与 IPv4 首部相比，取消了首部长度、服务类型、总长度、标识、标志、片偏移、协议、检验和、选项等字段，新增通信量类、流标号字段，修改 TTL 为跳数限制，协议改为下一个首部。基本首部各字段含义：</p>
<ol>
<li><strong>版本</strong>：4 比特，IPv6 对应值为 6。</li>
<li><strong>通信量类</strong>：8 比特，区分数据报类别或优先级。</li>
<li><strong>流标号</strong>：20 比特，标识 “流”（特定源到目的的一系列数据报），用于资源预分配，非实时数据置 0。</li>
<li><strong>有效载荷长度</strong>：16 比特，表基本首部后有效载荷字节数，最大 65535 字节。</li>
<li><strong>下一个首部</strong>：8 比特，无扩展首部时表数据协议类型，有扩展首部时表首个扩展首部类型。</li>
<li><strong>跳数限制</strong>：8 比特，源主机设初始值（最大 255），路由器转发时减 1，为 0 则丢弃。</li>
<li><strong>源地址、目的地址</strong>：各 128 比特，分别表发送端和接收端 IPv6 地址。</li>
</ol>
<h3 id="4-9-3-IPv6-数据报的扩展首部"><a href="#4-9-3-IPv6-数据报的扩展首部" class="headerlink" title="4.9.3 IPv6 数据报的扩展首部"></a>4.9.3 IPv6 数据报的扩展首部</h3><p>IPv6 将 IPv4 首部选项放入扩展首部，由源点和终点主机处理，路径中路由器不处理（除逐跳选项扩展首部），提高处理效率。RFC 2460 定义六种扩展首部：逐跳选项、路由选择、分片、鉴别、封装安全有效载荷、目的站选项。每个扩展首部首字段为 8 比特下一个首部字段，多个扩展首部按特定顺序出现。</p>
<h3 id="4-9-4-IPv6-地址"><a href="#4-9-4-IPv6-地址" class="headerlink" title="4.9.4 IPv6 地址"></a>4.9.4 IPv6 地址</h3><ol>
<li><strong>地址分配</strong>：IPv6 给节点每个接口指派地址，节点可有多个单播地址。</li>
<li><strong>地址空间大小</strong>：128 比特，地址空间为 2^128，极其巨大，可满足未来需求。</li>
<li><strong>表示方法</strong>：采用冒号十六进制记法，将 128 比特每 16 比特为一组（共 8 组），组间用 “:” 分隔，每组 4 比特转十六进制数。可 “左侧零” 省略（十六进制数前导零省略）和 “连续零” 压缩（连续零用 “::” 替代，一个地址仅用一次），还可结合点分十进制后缀（过渡阶段用），CIDR 斜线记法仍适用。</li>
<li><strong>地址分类</strong><ul>
<li><strong>目的地址类型</strong>：单播（点对点）、多播（一点对多点，广播为多播特例）、任播（一点对一组中最近一个）。</li>
<li><strong>地址分类</strong>：未指明地址（全 0，缩写 “::”，仅作源地址）、环回地址（仅最低比特 1，其余全 0，缩写 “::1”）、多播地址（首 8 比特全 1，记为 FF00::&#x2F;8）、本地链路单播地址（首 10 比特 1111111010，记为 FE80::&#x2F;10，仅本地网络通信）、全球单播地址（除上述四种，三级结构：48 比特全球路由选择前缀、16 比特子网标识符、64 比特接口标识符）。</li>
</ul>
</li>
</ol>
<h3 id="4-9-5-从-IPv4-向-IPv6-过渡"><a href="#4-9-5-从-IPv4-向-IPv6-过渡" class="headerlink" title="4.9.5 从 IPv4 向 IPv6 过渡"></a>4.9.5 从 IPv4 向 IPv6 过渡</h3><p>因因特网上 IPv4 路由器数量多，过渡需逐步进行，新 IPv6 系统需兼容 IPv4，主要有两种过渡策略：</p>
<ol>
<li><strong>双协议栈</strong>：主机或路由器装 IPv4 和 IPv6 两套协议栈，可与两种系统通信，记为 IPv6&#x2F;IPv4。双协议栈主机通过 DNS 查询目的主机地址类型，选择对应协议通信。例如 IPv6 主机 A 给 B 发送数据报，经 IPv6&#x2F;IPv4 路由器 R1、R4 及 IPv4 路由器 R2、R3，R1 将 IPv6 数据报转为 IPv4 数据报，R2、R3 转发，R4 再恢复为 IPv6 数据报给 B，转换可能损失部分 IPv6 字段信息。</li>
<li><strong>隧道技术</strong>：IPv6 数据报进入 IPv4 网络时，封装成 IPv4 数据报（IPv6 数据报为数据部分），IPv4 数据报在 IPv4 网络传输，离开时取出 IPv6 数据报转发。IPv4 数据报源、目的为隧道入口、出口路由器 IPv4 地址，协议字段设为 41，表明数据部分为 IPv6 数据报。</li>
</ol>
<h3 id="4-9-6-网际控制报文协议-ICMPv6"><a href="#4-9-6-网际控制报文协议-ICMPv6" class="headerlink" title="4.9.6 网际控制报文协议 ICMPv6"></a>4.9.6 网际控制报文协议 ICMPv6</h3><p>IPv6 需 ICMPv6 反馈差错信息，比 ICMPv4 复杂，合并 ARP 和 IGMP 功能，因此 IPv6 网际层仅 ICMPv6 一个配套协议。ICMPv6 报文封装成 IPv6 数据报发送，前面是基本首部和扩展首部，前面首部的下一个首部字段置为 58。ICMPv6 报文可报告差错、获取信息、探测邻站、管理多播通信，常用报文类型有目的站不可达、分组太长、时间超过、参数问题（差错报告），回送请求、回答（查询），多播听众查询、报告、完成（多播管理），路由器询问、通告、邻站询问、通告、改变路由（邻站发现）等。</p>
<h2 id="4-10-软件定义网络（SDN）"><a href="#4-10-软件定义网络（SDN）" class="headerlink" title="4.10 软件定义网络（SDN）"></a>4.10 软件定义网络（SDN）</h2><p>SDN 由 Nick McKeown 教授于 2009 年提出，最初是学术探讨的网络体系结构，后被企业采用（如谷歌 B4 数据中心网络），能提高带宽利用率、稳定性，简化管理，降低成本，是当前网络领域热门技术。</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://pic1.imgdb.cn/item/684818ef58cb8da5c8419e1e.png&quot;" data-lazy-src="https://pic1.imgdb.cn/item/682f3d1658cb8da5c807b704.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://pic1.imgdb.cn/item/684818ef58cb8da5c8419e1e.png&quot;" data-lazy-src="https://pic1.imgdb.cn/item/682f3d1658cb8da5c807b704.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">woodfish</div><div class="post-copyright__author_desc">HOLA,this is woodfish!</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://www.woodfishhhh.xyz/2025/10/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%88edit%EF%BC%89/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://www.woodfishhhh.xyz/2025/10/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%88edit%EF%BC%89/')">木鱼的鱼窝</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://www.woodfishhhh.xyz/images/e926e309585e5a5826ab0c3b485f8b6.png?_t=1751445131356" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://pic1.imgdb.cn/item/684818ef58cb8da5c8419e1e.png&quot;" data-lazy-src="https://www.woodfishhhh.xyz/images/e926e309585e5a5826ab0c3b485f8b6.png?_t=1751445131356" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://www.woodfishhhh.xyz/images/8147e2d92fa8287fac8774305c99661.jpg.jpeg?_t=1751445131356" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://pic1.imgdb.cn/item/684818ef58cb8da5c8419e1e.png&quot;" data-lazy-src="https://www.woodfishhhh.xyz/images/8147e2d92fa8287fac8774305c99661.jpg.jpeg?_t=1751445131356" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://www.woodfishhhh.xyz/2025/10/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%88edit%EF%BC%89/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=木鱼的鱼窝&amp;url=https://www.woodfishhhh.xyz/2025/10/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%88edit%EF%BC%89/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.woodfishhhh.xyz" target="_blank">木鱼的鱼窝</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"></div></div></div><div class="post_share"><div class="social-share" data-image="https://pic1.imgdb.cn/item/682f3d1658cb8da5c807b704.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/09/11/%E5%89%8D%E7%AB%AF/Day04_AJAX%E8%BF%9B%E9%98%B6/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://pic1.imgdb.cn/item/684818ef58cb8da5c8419e1e.png&quot;" data-lazy-src="/" onerror="onerror=null;src='https://pic1.imgdb.cn/item/684818ef58cb8da5c8419e1e.png'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Day04_AJAX进阶</div></div></a></div><div class="next-post pull-right"><a href="/2025/10/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%B1%82/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://pic1.imgdb.cn/item/684818ef58cb8da5c8419e1e.png&quot;" data-lazy-src="/" onerror="onerror=null;src='https://pic1.imgdb.cn/item/684818ef58cb8da5c8419e1e.png'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info"></div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://pic1.imgdb.cn/item/684818ef58cb8da5c8419e1e.png&quot;" data-lazy-src="https://pic1.imgdb.cn/item/682f3d1658cb8da5c807b704.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://pic1.imgdb.cn/item/684818ef58cb8da5c8419e1e.png&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description">河汉微明星乍稀，碧莲香湿袭人衣。夜凉如水琉璃滑，自起开窗放月归。</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">woodfish</h1><div class="author-info__desc">HOLA,this is woodfish!</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/woodfishhhh" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/359728114" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a><a class="social-icon faa-parent animated-hover" href="https://www.woodfishhhh.xyz/images/af1a055d14e4f7f6eae2886f2865d13.jpg.jpeg?_t=1750312382930" target="_blank" title="QQ"><i class="anzhiyufont anzhiyu-icon-qq"></i></a><a class="social-icon faa-parent animated-hover" href="https://www.woodfishhhh.xyz/images/f59723db9159310b6056abe8341f5d7.jpg.jpeg?_t=1750312263368" target="_blank" title="WeChat"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a class="social-icon faa-parent animated-hover" href="https://www.woodfishhhh.xyz/images/d8d58d2f2c7ac5790fd37f388da41db4.png?_t=1759286665402" target="_blank" title="Email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="social-icon faa-parent animated-hover" href="https://www.douyin.com/user/MS4wLjABAAAAgbOrIhdi7Rl5RfaQ3fE3i7c2WnyR3zEOyLiK2Cjtcqk?from_tab_name=main" target="_blank" title="Douyin"><i class="anzhiyufont anzhiyu-icon-tiktok"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的鱼窝~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E7%BD%91%E7%BB%9C%E5%B1%82%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">4.1 网络层概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-%E5%88%86%E7%BB%84%E8%BD%AC%E5%8F%91%E5%92%8C%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9"><span class="toc-number">1.1.</span> <span class="toc-text">4.1.1 分组转发和路由选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2-%E7%BD%91%E7%BB%9C%E5%B1%82%E5%90%91%E5%85%B6%E4%B8%8A%E5%B1%82%E6%8F%90%E4%BE%9B%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.2.</span> <span class="toc-text">4.1.2 网络层向其上层提供的两种服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E7%BD%91%E9%99%85%E5%8D%8F%E8%AE%AE%EF%BC%88IP%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">4.2 网际协议（IP）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-%E5%BC%82%E6%9E%84%E7%BD%91%E7%BB%9C%E4%BA%92%E8%BF%9E"><span class="toc-number">2.1.</span> <span class="toc-text">4.2.1 异构网络互连</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-IPv4-%E5%9C%B0%E5%9D%80%E5%8F%8A%E5%85%B6%E7%BC%96%E5%9D%80%E6%96%B9%E6%B3%95"><span class="toc-number">2.2.</span> <span class="toc-text">4.2.2 IPv4 地址及其编址方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-IPv4-%E5%9C%B0%E5%9D%80%E7%9A%84%E5%BA%94%E7%94%A8%E8%A7%84%E5%88%92"><span class="toc-number">2.3.</span> <span class="toc-text">4.2.3 IPv4 地址的应用规划</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-4-IPv4-%E5%9C%B0%E5%9D%80%E4%B8%8E-MAC-%E5%9C%B0%E5%9D%80"><span class="toc-number">2.4.</span> <span class="toc-text">4.2.4 IPv4 地址与 MAC 地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-5-%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.5.</span> <span class="toc-text">4.2.5 地址解析协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-6-IP-%E6%95%B0%E6%8D%AE%E6%8A%A5%E7%9A%84%E5%8F%91%E9%80%81%E5%92%8C%E8%BD%AC%E5%8F%91%E8%BF%87%E7%A8%8B"><span class="toc-number">2.6.</span> <span class="toc-text">4.2.6 IP 数据报的发送和转发过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-7-IPv4-%E6%95%B0%E6%8D%AE%E6%8A%A5%E7%9A%84%E9%A6%96%E9%83%A8%E6%A0%BC%E5%BC%8F"><span class="toc-number">2.7.</span> <span class="toc-text">4.2.7 IPv4 数据报的首部格式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE"><span class="toc-number">3.</span> <span class="toc-text">4.3 静态路由配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-1-%E7%9B%B4%E8%BF%9E%E8%B7%AF%E7%94%B1%E5%92%8C%E9%9D%9E%E7%9B%B4%E8%BF%9E%E8%B7%AF%E7%94%B1"><span class="toc-number">3.1.</span> <span class="toc-text">4.3.1 直连路由和非直连路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-2-%E9%BB%98%E8%AE%A4%E8%B7%AF%E7%94%B1%E5%92%8C%E7%89%B9%E5%AE%9A%E4%B8%BB%E6%9C%BA%E8%B7%AF%E7%94%B1"><span class="toc-number">3.2.</span> <span class="toc-text">4.3.2 默认路由和特定主机路由</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E5%9B%A0%E7%89%B9%E7%BD%91%E7%9A%84%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.</span> <span class="toc-text">4.4 因特网的路由选择协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-1-%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%88%86%E7%B1%BB"><span class="toc-number">4.1.</span> <span class="toc-text">4.4.1 路由选择分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-2-%E5%9B%A0%E7%89%B9%E7%BD%91%E9%87%87%E7%94%A8%E5%88%86%E5%B1%82%E6%AC%A1%E7%9A%84%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.2.</span> <span class="toc-text">4.4.2 因特网采用分层次的路由选择协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-3-%E8%B7%AF%E7%94%B1%E4%BF%A1%E6%81%AF%E5%8D%8F%E8%AE%AE%EF%BC%88RIP%EF%BC%89"><span class="toc-number">4.3.</span> <span class="toc-text">4.4.3 路由信息协议（RIP）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-4-%E5%BC%80%E6%94%BE%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E4%BC%98%E5%85%88%E5%8D%8F%E8%AE%AE%EF%BC%88OSPF%EF%BC%89"><span class="toc-number">4.4.</span> <span class="toc-text">4.4.4 开放最短路径优先协议（OSPF）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-5-%E8%BE%B9%E7%95%8C%E7%BD%91%E5%85%B3%E5%8D%8F%E8%AE%AE%EF%BC%88BGP%EF%BC%89"><span class="toc-number">4.5.</span> <span class="toc-text">4.4.5 边界网关协议（BGP）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-6-%E8%B7%AF%E7%94%B1%E5%99%A8%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">4.6.</span> <span class="toc-text">4.4.6 路由器的基本工作原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-%E7%BD%91%E9%99%85%E6%8E%A7%E5%88%B6%E6%8A%A5%E6%96%87%E5%8D%8F%E8%AE%AE%EF%BC%88ICMP%EF%BC%89"><span class="toc-number">5.</span> <span class="toc-text">4.5 网际控制报文协议（ICMP）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-1-ICMP-%E6%8A%A5%E6%96%87%E7%9A%84%E7%A7%8D%E7%B1%BB"><span class="toc-number">5.1.</span> <span class="toc-text">4.5.1 ICMP 报文的种类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-2-ICMP-%E7%9A%84%E5%85%B8%E5%9E%8B%E5%BA%94%E7%94%A8"><span class="toc-number">5.2.</span> <span class="toc-text">4.5.2 ICMP 的典型应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6-%E8%99%9A%E6%8B%9F%E4%B8%93%E7%94%A8%E7%BD%91%EF%BC%88VPN%EF%BC%89%E5%92%8C%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2%EF%BC%88NAT%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">4.6 虚拟专用网（VPN）和网络地址转换（NAT）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-1-%E8%99%9A%E6%8B%9F%E4%B8%93%E7%94%A8%E7%BD%91%EF%BC%88VPN%EF%BC%89"><span class="toc-number">6.1.</span> <span class="toc-text">4.6.1 虚拟专用网（VPN）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-2-%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2%EF%BC%88NAT%EF%BC%89"><span class="toc-number">6.2.</span> <span class="toc-text">4.6.2 网络地址转换（NAT）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-7-IP-%E5%A4%9A%E6%92%AD"><span class="toc-number">7.</span> <span class="toc-text">4.7 IP 多播</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-1-IP-%E5%A4%9A%E6%92%AD%E6%8A%80%E6%9C%AF%E7%9A%84%E7%9B%B8%E5%85%B3%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">7.1.</span> <span class="toc-text">4.7.1 IP 多播技术的相关基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-2-IP-%E5%A4%9A%E6%92%AD%E5%9C%B0%E5%9D%80%E5%92%8C%E5%A4%9A%E6%92%AD%E7%BB%84"><span class="toc-number">7.2.</span> <span class="toc-text">4.7.2 IP 多播地址和多播组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-3-%E5%9C%A8%E5%B1%80%E5%9F%9F%E7%BD%91%E4%B8%8A%E8%BF%9B%E8%A1%8C%E7%A1%AC%E4%BB%B6%E5%A4%9A%E6%92%AD"><span class="toc-number">7.3.</span> <span class="toc-text">4.7.3 在局域网上进行硬件多播</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-4-%E5%9C%A8%E5%9B%A0%E7%89%B9%E7%BD%91%E4%B8%8A%E8%BF%9B%E8%A1%8C-IP-%E5%A4%9A%E6%92%AD%E9%9C%80%E8%A6%81%E7%9A%84%E4%B8%A4%E7%A7%8D%E5%8D%8F%E8%AE%AE"><span class="toc-number">7.4.</span> <span class="toc-text">4.7.4 在因特网上进行 IP 多播需要的两种协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-5-%E7%BD%91%E9%99%85%E7%BB%84%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%EF%BC%88IGMP%EF%BC%89"><span class="toc-number">7.5.</span> <span class="toc-text">4.7.5 网际组管理协议（IGMP）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-6-%E5%A4%9A%E6%92%AD%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%8D%8F%E8%AE%AE"><span class="toc-number">7.6.</span> <span class="toc-text">4.7.6 多播路由选择协议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-8-%E7%A7%BB%E5%8A%A8-IP-%E6%8A%80%E6%9C%AF"><span class="toc-number">8.</span> <span class="toc-text">4.8 移动 IP 技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-1-%E7%A7%BB%E5%8A%A8%E6%80%A7%E5%AF%B9%E5%9B%A0%E7%89%B9%E7%BD%91%E5%BA%94%E7%94%A8%E7%9A%84%E5%BD%B1%E5%93%8D"><span class="toc-number">8.1.</span> <span class="toc-text">4.8.1 移动性对因特网应用的影响</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-2-%E7%A7%BB%E5%8A%A8-IP-%E6%8A%80%E6%9C%AF%E7%9A%84%E7%9B%B8%E5%85%B3%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">8.2.</span> <span class="toc-text">4.8.2 移动 IP 技术的相关基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-3-%E7%A7%BB%E5%8A%A8-IP-%E6%8A%80%E6%9C%AF%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">8.3.</span> <span class="toc-text">4.8.3 移动 IP 技术的基本工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-4-%E8%9C%82%E7%AA%9D%E7%A7%BB%E5%8A%A8%E9%80%9A%E4%BF%A1%E7%BD%91%E4%B8%AD%E7%9A%84%E7%A7%BB%E5%8A%A8%E6%80%A7%E7%AE%A1%E7%90%86"><span class="toc-number">8.4.</span> <span class="toc-text">4.8.4 蜂窝移动通信网中的移动性管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-9-%E4%B8%8B%E4%B8%80%E4%BB%A3%E7%BD%91%E9%99%85%E5%8D%8F%E8%AE%AE-IPv6"><span class="toc-number">9.</span> <span class="toc-text">4.9 下一代网际协议 IPv6</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-1-IPv6-%E5%BC%95%E8%BF%9B%E7%9A%84%E4%B8%BB%E8%A6%81%E5%8F%98%E5%8C%96"><span class="toc-number">9.1.</span> <span class="toc-text">4.9.1 IPv6 引进的主要变化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-2-IPv6-%E6%95%B0%E6%8D%AE%E6%8A%A5%E7%9A%84%E5%9F%BA%E6%9C%AC%E9%A6%96%E9%83%A8"><span class="toc-number">9.2.</span> <span class="toc-text">4.9.2 IPv6 数据报的基本首部</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-3-IPv6-%E6%95%B0%E6%8D%AE%E6%8A%A5%E7%9A%84%E6%89%A9%E5%B1%95%E9%A6%96%E9%83%A8"><span class="toc-number">9.3.</span> <span class="toc-text">4.9.3 IPv6 数据报的扩展首部</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-4-IPv6-%E5%9C%B0%E5%9D%80"><span class="toc-number">9.4.</span> <span class="toc-text">4.9.4 IPv6 地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-5-%E4%BB%8E-IPv4-%E5%90%91-IPv6-%E8%BF%87%E6%B8%A1"><span class="toc-number">9.5.</span> <span class="toc-text">4.9.5 从 IPv4 向 IPv6 过渡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-6-%E7%BD%91%E9%99%85%E6%8E%A7%E5%88%B6%E6%8A%A5%E6%96%87%E5%8D%8F%E8%AE%AE-ICMPv6"><span class="toc-number">9.6.</span> <span class="toc-text">4.9.6 网际控制报文协议 ICMPv6</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-10-%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C%EF%BC%88SDN%EF%BC%89"><span class="toc-number">10.</span> <span class="toc-text">4.10 软件定义网络（SDN）</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/08/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E5%8A%A0%E5%87%8F%E4%B9%98%E9%99%A4/" title="无题">无题</a><time datetime="2025-11-08T05:40:40.527Z" title="发表于 2025-11-08 13:40:40">2025-11-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/29/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%89%A9%E7%90%86%E5%B1%82%E8%AF%A6%E7%BB%86%E7%AC%94%E8%AE%B0/" title="无题">无题</a><time datetime="2025-10-29T07:08:43.380Z" title="发表于 2025-10-29 15:08:43">2025-10-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/29/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E6%A6%82%E8%AE%BA/" title="无题">无题</a><time datetime="2025-10-29T06:56:18.575Z" title="发表于 2025-10-29 14:56:18">2025-10-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/28/test/" title="无题">无题</a><time datetime="2025-10-28T13:21:51.776Z" title="发表于 2025-10-28 21:21:51">2025-10-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/27/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91/" title="无题">无题</a><time datetime="2025-10-27T12:38:53.879Z" title="发表于 2025-10-27 20:38:53">2025-10-27</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><div id="runtimeTextTip"></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2025 By <a class="footer-bar-link" href="/" title="woodfish" target="_blank">woodfish</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">62</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">3</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://www.woodfishhhh.xyz/" title="woodfishhhh博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://pic1.imgdb.cn/item/684818ef58cb8da5c8419e1e.png&quot;" data-lazy-src="/img/favicon.ico" alt="woodfishhhh博客"/><span class="back-menu-item-text">woodfishhhh博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://47.99.92.213" title="江西财经大学程序设计竞赛协会"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://pic1.imgdb.cn/item/684818ef58cb8da5c8419e1e.png&quot;" data-lazy-src="https://www.woodfishhhh.xyz/images/116983c54294980f75bc7117d81c6d1e.png?_t=1754227079323" alt="江西财经大学程序设计竞赛协会"/><span class="back-menu-item-text">江西财经大学程序设计竞赛协会</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fas fa-home faa-tada"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><i class="fas fa-tags faa-tada"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><i class="fas fa-th faa-tada"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><i class="fas fa-link faa-tada"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><i class="fas fa-user faa-tada"></i><span> 关于我</span></a></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Ajax/" style="font-size: 0.88rem;">Ajax<sup>4</sup></a><a href="/tags/CSS/" style="font-size: 0.88rem;">CSS<sup>15</sup></a><a href="/tags/HTML/" style="font-size: 0.88rem;">HTML<sup>17</sup></a><a href="/tags/Java/" style="font-size: 0.88rem;">Java<sup>9</sup></a><a href="/tags/JavaScript/" style="font-size: 0.88rem;">JavaScript<sup>16</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>2</sup></a><a href="/tags/web/" style="font-size: 0.88rem;">web<sup>11</sup></a><a href="/tags/%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/" style="font-size: 0.88rem;">期末复习<sup>2</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("06/02/2025 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2025 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 woodfish 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("06/02/2025 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "";
        img.title = "";
        img.alt = "";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v6.2.0" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://pic1.imgdb.cn/item/684818ef58cb8da5c8419e1e.png&quot;" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v4.3.1" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://pic1.imgdb.cn/item/684818ef58cb8da5c8419e1e.png&quot;" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" data-title="本站采用多线部署，主线路托管于Vercel" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://pic1.imgdb.cn/item/684818ef58cb8da5c8419e1e.png&quot;" data-lazy-src="https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel" alt=""/></a><a class="github-badge" target="_blank" href="https://dashboard.4everland.org/" style="margin-inline:5px" data-title="本站采用多线部署，备用线路托管于4EVERLAND" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://pic1.imgdb.cn/item/684818ef58cb8da5c8419e1e.png&quot;" data-lazy-src="https://img.shields.io/badge/Hosted-4EVERLAND-22DDDD?style=flat&amp;logo=IPFS" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://pic1.imgdb.cn/item/684818ef58cb8da5c8419e1e.png&quot;" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://pic1.imgdb.cn/item/684818ef58cb8da5c8419e1e.png&quot;" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="/js/runtime.js"></script><!-- hexo injector body_end end --></body></html>